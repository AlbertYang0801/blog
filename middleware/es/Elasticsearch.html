<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch总结 | 技术小站</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="logo.ico">
    <meta name="description" content="生活不止眼前的代码，还有迈向田野的步伐">
    
    <link rel="preload" href="/blog/assets/css/0.styles.069fd700.css" as="style"><link rel="preload" href="/blog/assets/js/app.86d3a547.js" as="script"><link rel="preload" href="/blog/assets/js/2.7ded94f8.js" as="script"><link rel="preload" href="/blog/assets/js/73.92a812fd.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2c31f16c.js"><link rel="prefetch" href="/blog/assets/js/11.26e43f23.js"><link rel="prefetch" href="/blog/assets/js/12.f2fb9538.js"><link rel="prefetch" href="/blog/assets/js/13.5d78287a.js"><link rel="prefetch" href="/blog/assets/js/14.4ee95829.js"><link rel="prefetch" href="/blog/assets/js/15.965c8199.js"><link rel="prefetch" href="/blog/assets/js/16.2a5012cd.js"><link rel="prefetch" href="/blog/assets/js/17.6cb8f1d5.js"><link rel="prefetch" href="/blog/assets/js/18.d484c9d2.js"><link rel="prefetch" href="/blog/assets/js/19.4c6b3560.js"><link rel="prefetch" href="/blog/assets/js/20.06472fe5.js"><link rel="prefetch" href="/blog/assets/js/21.c4543600.js"><link rel="prefetch" href="/blog/assets/js/22.74c530ae.js"><link rel="prefetch" href="/blog/assets/js/23.043d2584.js"><link rel="prefetch" href="/blog/assets/js/24.c6aa203c.js"><link rel="prefetch" href="/blog/assets/js/25.976b4905.js"><link rel="prefetch" href="/blog/assets/js/26.9d6de787.js"><link rel="prefetch" href="/blog/assets/js/27.471afdc5.js"><link rel="prefetch" href="/blog/assets/js/28.7d155518.js"><link rel="prefetch" href="/blog/assets/js/29.c07d7abc.js"><link rel="prefetch" href="/blog/assets/js/3.ff39b541.js"><link rel="prefetch" href="/blog/assets/js/30.72de95e8.js"><link rel="prefetch" href="/blog/assets/js/31.2b29f69d.js"><link rel="prefetch" href="/blog/assets/js/32.27c4c2d1.js"><link rel="prefetch" href="/blog/assets/js/33.d3990d49.js"><link rel="prefetch" href="/blog/assets/js/34.a6fbf97c.js"><link rel="prefetch" href="/blog/assets/js/35.70aa1261.js"><link rel="prefetch" href="/blog/assets/js/36.c6681141.js"><link rel="prefetch" href="/blog/assets/js/37.adf492bb.js"><link rel="prefetch" href="/blog/assets/js/38.290b5f7c.js"><link rel="prefetch" href="/blog/assets/js/39.dac4127d.js"><link rel="prefetch" href="/blog/assets/js/4.56fda3ff.js"><link rel="prefetch" href="/blog/assets/js/40.a068c386.js"><link rel="prefetch" href="/blog/assets/js/41.bacc6213.js"><link rel="prefetch" href="/blog/assets/js/42.7938fb6f.js"><link rel="prefetch" href="/blog/assets/js/43.4e9690ad.js"><link rel="prefetch" href="/blog/assets/js/44.5cc9e39f.js"><link rel="prefetch" href="/blog/assets/js/45.8c1f5c7c.js"><link rel="prefetch" href="/blog/assets/js/46.f59d0ee8.js"><link rel="prefetch" href="/blog/assets/js/47.546afc2e.js"><link rel="prefetch" href="/blog/assets/js/48.1a68748d.js"><link rel="prefetch" href="/blog/assets/js/49.3a92c271.js"><link rel="prefetch" href="/blog/assets/js/5.7d16fc96.js"><link rel="prefetch" href="/blog/assets/js/50.07273b0d.js"><link rel="prefetch" href="/blog/assets/js/51.a8cd78e4.js"><link rel="prefetch" href="/blog/assets/js/52.fdace2e8.js"><link rel="prefetch" href="/blog/assets/js/53.e2e159ba.js"><link rel="prefetch" href="/blog/assets/js/54.b6a2c082.js"><link rel="prefetch" href="/blog/assets/js/55.d4f8a95e.js"><link rel="prefetch" href="/blog/assets/js/56.a7f9fa12.js"><link rel="prefetch" href="/blog/assets/js/57.a2346e8a.js"><link rel="prefetch" href="/blog/assets/js/58.f6567a49.js"><link rel="prefetch" href="/blog/assets/js/59.74bed024.js"><link rel="prefetch" href="/blog/assets/js/6.c1bd8a18.js"><link rel="prefetch" href="/blog/assets/js/60.93fc2c7f.js"><link rel="prefetch" href="/blog/assets/js/61.6b5a302a.js"><link rel="prefetch" href="/blog/assets/js/62.3efbcca6.js"><link rel="prefetch" href="/blog/assets/js/63.084db28b.js"><link rel="prefetch" href="/blog/assets/js/64.02cae5a6.js"><link rel="prefetch" href="/blog/assets/js/65.23d0f537.js"><link rel="prefetch" href="/blog/assets/js/66.e27df514.js"><link rel="prefetch" href="/blog/assets/js/67.a4126e93.js"><link rel="prefetch" href="/blog/assets/js/68.98a6a1e0.js"><link rel="prefetch" href="/blog/assets/js/69.c7b8b5d9.js"><link rel="prefetch" href="/blog/assets/js/7.8d45ee92.js"><link rel="prefetch" href="/blog/assets/js/70.1b647502.js"><link rel="prefetch" href="/blog/assets/js/71.42896759.js"><link rel="prefetch" href="/blog/assets/js/72.779408a1.js"><link rel="prefetch" href="/blog/assets/js/74.d7c8f76b.js"><link rel="prefetch" href="/blog/assets/js/75.c49ef70f.js"><link rel="prefetch" href="/blog/assets/js/76.f565b59a.js"><link rel="prefetch" href="/blog/assets/js/77.86b756a3.js"><link rel="prefetch" href="/blog/assets/js/78.97732568.js"><link rel="prefetch" href="/blog/assets/js/79.e26f316a.js"><link rel="prefetch" href="/blog/assets/js/8.fbb7d904.js"><link rel="prefetch" href="/blog/assets/js/80.a5a650a8.js"><link rel="prefetch" href="/blog/assets/js/81.769901b3.js"><link rel="prefetch" href="/blog/assets/js/82.8bc1d128.js"><link rel="prefetch" href="/blog/assets/js/83.a67566f0.js"><link rel="prefetch" href="/blog/assets/js/84.e9152b73.js"><link rel="prefetch" href="/blog/assets/js/85.6d91ebe0.js"><link rel="prefetch" href="/blog/assets/js/86.c0ef6859.js"><link rel="prefetch" href="/blog/assets/js/87.232e22d9.js"><link rel="prefetch" href="/blog/assets/js/88.d19966cc.js"><link rel="prefetch" href="/blog/assets/js/89.fbd20b86.js"><link rel="prefetch" href="/blog/assets/js/9.c16fb42f.js"><link rel="prefetch" href="/blog/assets/js/90.679d3b3b.js"><link rel="prefetch" href="/blog/assets/js/91.7a910889.js"><link rel="prefetch" href="/blog/assets/js/92.85c37f0b.js"><link rel="prefetch" href="/blog/assets/js/93.68a2e8a2.js"><link rel="prefetch" href="/blog/assets/js/94.2176f131.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.069fd700.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">技术小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java篇" class="dropdown-title"><span class="title">Java篇</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java篇" class="mobile-dropdown-title"><span class="title">Java篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/collection/" class="nav-link">
  Java容器
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/jvm/" class="nav-link">
  JVM虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/concurrent/" class="nav-link">
  高并发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架篇" class="dropdown-title"><span class="title">框架篇</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架篇" class="mobile-dropdown-title"><span class="title">框架篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/middleware/es/" class="nav-link router-link-active">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><a href="/blog/design/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/util/" class="nav-link">
  工具向
</a></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java篇" class="dropdown-title"><span class="title">Java篇</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java篇" class="mobile-dropdown-title"><span class="title">Java篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/collection/" class="nav-link">
  Java容器
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/jvm/" class="nav-link">
  JVM虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/concurrent/" class="nav-link">
  高并发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架篇" class="dropdown-title"><span class="title">框架篇</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架篇" class="mobile-dropdown-title"><span class="title">框架篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/middleware/es/" class="nav-link router-link-active">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><a href="/blog/design/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/util/" class="nav-link">
  工具向
</a></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>elasticsearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/middleware/es/Elasticsearch简介.html" class="sidebar-link">简介</a></li><li><a href="/blog/middleware/es/Elasticsearch环境安装.html" class="sidebar-link">环境安装</a></li><li><a href="/blog/middleware/es/Elasticsearch基础概念.html" class="sidebar-link">基础概念</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch总结"><a href="#elasticsearch总结" class="header-anchor">#</a> Elasticsearch总结</h1> <h2 id="一、es-简介"><a href="#一、es-简介" class="header-anchor">#</a> 一、ES 简介</h2> <h3 id="elasticsearch介绍"><a href="#elasticsearch介绍" class="header-anchor">#</a> Elasticsearch介绍</h3> <p><strong>百度百科</strong></p> <blockquote><p>Elasticsearch 是一个分布式、高扩展、高实时的搜索与<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/6577123" target="_blank" rel="noopener noreferrer">数据分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>引擎。它能很方便的使大量数据具有搜索、分析和探索的能力。充分利用Elasticsearch的水平伸缩性，能使数据在生产环境变得更有价值。Elasticsearch 的实现原理主要分为以下几个步骤，首先用户将数据提交到Elasticsearch 数据库中，再通过分词控制器去将对应的语句分词，将其权重和分词结果一并存入数据，当用户搜索数据时候，再根据权重将结果排名，打分，再将返回结果呈现给用户。</p> <p>Elasticsearch是与名为Logstash的数据收集和日志解析引擎以及名为Kibana的分析和可视化平台一起开发的。这三个产品被设计成一个集成解决方案，称为“Elastic Stack”（以前称为“ELK stack”）。</p> <p>Elasticsearch可以用于搜索各种文档。它提供可扩展的搜索，具有接近实时的搜索，并支持多租户。”Elasticsearch是分布式的，这意味着索引可以被分成分片，每个分片可以有0个或多个副本。每个节点托管一个或多个分片，并充当协调器将操作委托给正确的分片。再平衡和路由是自动完成的。“相关数据通常存储在同一个索引中，该索引由一个或多个主分片和零个或多个复制分片组成。一旦创建了索引，就不能更改主分片的数量。</p> <p>Elasticsearch使用Lucene，并试图通过JSON和Java API提供其所有特性。它支持facetting和percolating，如果新文档与注册查询匹配，这对于通知非常有用。另一个特性称为“网关”，处理索引的长期持久性；例如，在服务器崩溃的情况下，可以从网关恢复索引。Elasticsearch支持实时GET请求，适合作为NoSQL数据存储，但缺少<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F/7316617" target="_blank" rel="noopener noreferrer">分布式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>事务。</p></blockquote> <p><strong>总结</strong></p> <ol><li>Elasticsearch 是一个基于 Lucene 的高扩展性分布式搜索服务器。</li> <li>Elasticsearch 隐藏了 Lucene 的复杂性，对外提供 Restful 接口来操作。</li></ol> <h3 id="elk-stack"><a href="#elk-stack" class="header-anchor">#</a> Elk Stack</h3> <p>ELK Stack 是 Elasticsearch、Logstash、Kibana 三大开源框架的合集简称。</p> <ol><li>Elasticsearch  是一个基于Lucene、可分布式、近实时的搜索引擎，其通过 Restful 方式进行交互。</li> <li>Logstash 是一个数据引擎，可将不用来源数据对接进 Elasticsearch 或其它目的地中。</li> <li>Kibana 是一个数据可视化平台 。</li></ol> <h3 id="elasticsearch通信方式"><a href="#elasticsearch通信方式" class="header-anchor">#</a> Elasticsearch通信方式</h3> <ul><li>Java客户端通信 <strong>9300</strong> 端口。</li> <li>Restful方式通信，HTTP服务所在的端口，默认为 <strong>9200</strong> 端口。</li></ul> <h3 id="搜索引擎对比"><a href="#搜索引擎对比" class="header-anchor">#</a> 搜索引擎对比</h3> <p><strong>Elasticsearch vs Solr 总结</strong></p> <ol><li>es 基本是开箱即用，非常简单。Solr 安装略微复杂。</li> <li>Solr 利用 Zookeeper 进行分布式管理，而 Elasticsearch 自身带有分布式协调管理功能。</li> <li>Solr 支持更多格式的数据，比如 JSON、XML、CSV，而 Elasticsearch 仅支持 json 文件格式。</li> <li>Solr 官方提供的功能更多，而 Elasticsearch 本身更注重于核心功能，高级功能多有第三方插件提供，例如图形化界面需要kibana友好支撑</li> <li>Solr 查询快，但更新索引时慢（即插入删除慢），用于电商等查询多的应用；</li> <li>ES建立索引快（即查询慢），即实时性查询快，用于 facebook 新浪等搜索。</li> <li>是传统搜索应用的有力解决方案，但 Elasticsearch 更适用于新兴的实时搜索应用。</li> <li>Solr 比较成熟，有一个更大，更成熟的用户、开发和贡献者社区，而 Elasticsearch 相对开发维护者较少，更新太快，学习使用成本较高。</li></ol> <h2 id="二、环境安装"><a href="#二、环境安装" class="header-anchor">#</a> 二、环境安装</h2> <h3 id="elasticsearch-本地安装"><a href="#elasticsearch-本地安装" class="header-anchor">#</a> Elasticsearch 本地安装</h3> <p>本地安装 7.10.2 版本，解压即可。</p> <p><a href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-10-2" target="_blank" rel="noopener noreferrer">Elasticsearch 7.10.2下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110258.png" alt=""></p> <ul><li><p>启动命令</p> <p><code>./bin/elasticsearch</code></p></li> <li><p>校验安装是否成功</p> <p>直接在浏览器输入：<a href="http://localhost:9200" target="_blank" rel="noopener noreferrer">http://localhost:9200<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，出现如下结果表示安装成功。</p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110332.png" alt=""></p> <blockquote><p>You Know, for Search</p></blockquote></li></ul> <h3 id="es-head-插件"><a href="#es-head-插件" class="header-anchor">#</a> Es-head 插件</h3> <p>谷歌浏览器可以配置 es-head 插件，配置成功之后可直接连接 Es。（连接采用 Restful 方式通信，使用的是 9200 端口）</p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110429.png" alt=""></p> <ol><li><p>复合查询</p> <p>可以调用 Restful 接口，执行各种操作。</p> <p>例如：向指定索引新增文档。</p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110503.png" alt=""></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110515.png" alt=""></p></li> <li><p>基本查询</p> <p>基本查询可以按照插件提供的搜索条件进行查询。</p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110526.png" alt=""></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110536.png" alt=""></p></li></ol> <h3 id="kibana"><a href="#kibana" class="header-anchor">#</a> Kibana</h3> <p>使用 brew 安装。（注意：kibana 版本需和 ES 保持一致）</p> <ul><li><p>搜索可用版本</p> <p><code>brew search kibana</code></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110808.png" alt=""></p></li> <li><p>安装默认版本</p> <p><code>brew install kibana</code></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110819.png" alt=""></p></li> <li><p>kibana存放目录</p> <p><code>/usr/local/Cellar/kibana/7.10.2</code></p> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628110846.png" alt=""></p></li></ul> <h3 id="ik-分词器"><a href="#ik-分词器" class="header-anchor">#</a> IK 分词器</h3> <p>Elasticsearch 默认对中文不分词，所以需要安装 IK 分词器插件。</p> <p><strong>1. 分词器安装</strong></p> <ul><li>安装包下载</li></ul> <p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（注意：分词器版本和 ES 版本保持一致。）</p> <ul><li>在 ES 根目录下的 <code>plugins</code> 文件夹创建 <code>analysis-ik</code> 目录，并将下载的安装包 <code>elasticsearch-analysis-ik-7.10.2.zip</code> 解压到该目录并删除压缩包。</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628111108.png" alt=""></p> <p><strong>2. 分词测试</strong></p> <ul><li><p>接口测试</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>curl <span class="token operator">--</span>location <span class="token operator">--</span>request POST <span class="token string">'http://localhost:9200/course/_analyze'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
  <span class="token string">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试分词器，中文默认单词分开输出&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>未分词之前</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628111135.png" alt=""></p> <ul><li>分词之后</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628111144.png" alt=""></p> <h2 id="三、elasticsearch基础概念"><a href="#三、elasticsearch基础概念" class="header-anchor">#</a> 三、Elasticsearch基础概念</h2> <h3 id="索引库-index"><a href="#索引库-index" class="header-anchor">#</a> 索引库（index）</h3> <p>Elasticsearch的索引库是一个逻辑上的概念，存储了相同类型的文档内容。类似于 MySQL 数据表，MongoDB 中的集合。</p> <ol><li><p>新建索引库</p> <ul><li><p>number_of_shards</p> <p>设置分片的数量，在集群中通常设置多个分片，表示一个索引库将拆分成多片分别存储不同 的结点，提高了ES的处理能力和高可用性，入门程序使用单机环境，这里设置为 1。</p></li> <li><p>number_of_replicas</p> <p>设置副本的数量，设置副本是为了提高ES的高可靠性，单机环境设置为 0。</p></li></ul></li> <li><p>新建测试</p> <p>例如新建一个 order 索引库，5 个分片，无副本。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>curl <span class="token operator">--</span>location <span class="token operator">--</span>request PUT <span class="token string">'http://localhost:9200/order/'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;number_of_shards&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token string">&quot;number_of_replicas&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210628112620.png" alt=""></p></li> <li><p>索引含义区分</p> <ul><li><p>索引（名词）</p> <p>一个索引（index）对应一个索引库，就像是传统关系数据库 MySQL 中的数据库，是存储文档的地方。</p></li> <li><p>索引（动词）</p> <p>索引一个文档，代表将一个文档存储到索引库里，以便于文档被检索或者查询。</p> <p>类似于 MySQL 中的 <code>INSERT</code>  插入数据，不同的是索引会将旧文档覆盖。</p></li> <li><p>倒排索引</p> <p>在传统数据库中为了提高查询效率，通常会为特定列增加索引来达到。</p> <p>而在 Es 中采用了<strong>倒排索引</strong>的数据结构来提高查询效率。</p></li></ul></li></ol> <h3 id="类型-type"><a href="#类型-type" class="header-anchor">#</a> 类型（_type)</h3> <p>映射元数据字段中的<code>_type</code> 字段。代表着索引的类型，每个文档中都会有<code>_type</code>字段信息进行区分文档。</p> <blockquote><p>Elasticse arch 官网提出的近期版本对 type 概念的演变情况如下：</p> <p>在 5.X 版本中，一个 index 下可以创建多个 type；</p> <p>在 6.X 版本中，一个 index 下只能存在一个 type；</p> <p>在 7.X 版本中，直接去除了 type 的概念，就是说 index 不再会有 type。</p></blockquote> <p><strong>为什么ElasticSearch要在7.X版本去掉type?</strong></p> <blockquote><p>ES 最先的设计是用索引类比关系型数据库的数据库，用 <code>mapping type</code> 来类比表，一个索引中可以包含多个映射类别。这个类比存在一个严重的问题，就是当多个mapping type中存在同名字段时（特别是同名字段还是不同类型的），在一个索引中不好处理，因为搜索引擎中只有 索引-文档的结构，不同映射类别的数据都是一个一个的文档（只是包含的字段不一样而已）</p></blockquote> <h3 id="映射-mapping"><a href="#映射-mapping" class="header-anchor">#</a> 映射（mapping）</h3> <p>映射定义索引中有什么字段、进行字段类型确认。类似于数据库中表结构定义。</p> <ol><li>元字段</li></ol> <p>每个文档都有与之关联的元数据，例如<code>_index</code>、<code>_type</code>和 <code>_id</code> 等字段。创建映射类型时，可以自定义其中一些元数据字段的行为。</p> <table><thead><tr><th>元数据字段</th> <th>含义</th></tr></thead> <tbody><tr><td>_index</td> <td>文档所属索引</td></tr> <tr><td>_type</td> <td>文档映射类型（7.x 已废弃）</td></tr> <tr><td>_id</td> <td>文档 ID</td></tr> <tr><td>_source</td> <td>表示文档正文的原始 JSON</td></tr></tbody></table> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-fields.html" target="_blank" rel="noopener noreferrer">Elasticsearch Guide [7.13]-Mapping-Metadata fields<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol start="2"><li>ES 支持<strong>手动定义映射</strong>和<strong>动态映射</strong>两种映射方式。</li></ol> <ul><li><p><strong>动态映射</strong></p> <p>默认情况下，当在文档中找到以前未见过的字段时，Elasticsearch 会将新字段添加到类型映射中。<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/object.html" target="_blank" rel="noopener noreferrer"><code>object</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 通过将<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/dynamic.html" target="_blank" rel="noopener noreferrer"><code>dynamic</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>参数设置为<code>false</code>（忽略新字段）或设置为<code>strict</code>（在遇到未知字段时抛出异常），可以在文档和级别禁用此行为。（6.8 版本和 7.x 版本字段映射关系不同）。</p> <p>6.8字段映射关系截图：</p> <p>![image-20210629111920245](/Users/yangjunwei/Library/Application Support/typora-user-images/image-20210629111920245.png)</p> <p>参考：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/dynamic-field-mapping.html" target="_blank" rel="noopener noreferrer">Elasticsearch Guide [6.8]- Dynamic field mapping<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><strong>手动映射</strong></p> <p>可以通过 RestAPI 请求手动指定索引的映射。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>curl <span class="token operator">--</span>location <span class="token operator">--</span>request POST <span class="token string">'localhost:9200/course/_mapping'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><p>查看索引映射</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//查看所有映射</span>
curl <span class="token operator">--</span>location <span class="token operator">--</span>request GET <span class="token string">'http://localhost:9200/_mapping'</span>
  
<span class="token comment">//查看指定索引的映射</span>
curl <span class="token operator">--</span>location <span class="token operator">--</span>request GET <span class="token string">'localhost:9200/{索引}/_mapping'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>创建映射</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>POST localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引名<span class="token punctuation">}</span><span class="token operator">/</span>_mapping
  
  
curl <span class="token operator">--</span>location <span class="token operator">--</span>request POST <span class="token string">'localhost:9200/course/_mapping'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>更新映射</p> <p>映射创建成功之后，已有字段不允许更新，可以添加新字段。</p></li> <li><p>删除映射</p> <p>通过删除索引来删除映射。</p></li></ul></li></ul> <h3 id="文档-documents"><a href="#文档-documents" class="header-anchor">#</a> 文档（documents）</h3> <p>ES 是面向文档的，搜索和索引数据的最小单位是文档。官方文档基础介绍。</p> <blockquote><p>文档是可以被索引的基本信息单元。例如，您可以为单个客户创建一个文档，为单个产品创建另一个文档，以及为单个订单创建另一个文档。该文档以 JSON（JavaScript Object Notation）表示，这是一种普遍存在的互联网数据交换格式。</p> <p>在索引/类型中，您可以存储任意数量的文档。请注意，尽管文档物理上位于索引中，但文档实际上必须被索引/分配给索引内的类型。</p></blockquote> <p><strong>ES 中的文档类似 MySQL 数据表中的记录</strong>。</p> <p>ES 可以存储数据复杂的数据，而且每个数据还存在索引，便于搜索文档内容。）（关系型数据库存储数据结构复杂的数据时，先要打散数据存入数据库，再取出的时候往往需要拼接数据）</p> <ul><li><p>创建文档</p> <p>不指定Id的话，es 会自动创建 Id。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>POST http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引名<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>


curl <span class="token operator">--</span>location <span class="token operator">--</span>request POST <span class="token string">'http://localhost:9200/course/_doc'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Java进阶&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Java yyds&quot;</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>更新文档</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>POST http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引名<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token punctuation">{</span>文档<span class="token class-name">Id</span><span class="token punctuation">}</span>

curl <span class="token operator">--</span>location <span class="token operator">--</span>request POST <span class="token string">'http://localhost:9200/course/_doc/q_PQW3oBBs5dY209hPKx'</span> \
<span class="token operator">--</span>header <span class="token string">'Content-Type: application/json'</span> \
<span class="token operator">--</span>data<span class="token operator">-</span>raw '<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Java进阶&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">130</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot; updateJava yyds&quot;</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>删除文档</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>DELETE http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引名<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token punctuation">{</span>文档<span class="token class-name">Id</span><span class="token punctuation">}</span>
curl <span class="token operator">--</span>location <span class="token operator">--</span>request DELETE <span class="token string">'http://localhost:9200/course/_doc/qvPHW3oBBs5dY2098vLu'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>搜索所有文档</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>GET http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span>_search
curl <span class="token operator">--</span>location <span class="token operator">--</span>request GET <span class="token string">'http://localhost:9200/course/_doc/_search'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>根据文档Id查询文档</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>GET http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引名<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token punctuation">{</span>文档<span class="token class-name">Id</span><span class="token punctuation">}</span>

curl <span class="token operator">--</span>location <span class="token operator">--</span>request GET <span class="token string">'http://localhost:9200/course/_doc/qvPHW3oBBs5dY2098vLu'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>搜索指定参数文档</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>GET http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span><span class="token punctuation">{</span>索引<span class="token punctuation">}</span><span class="token operator">/</span>_doc<span class="token operator">/</span>_search<span class="token operator">?</span>q<span class="token operator">=</span><span class="token punctuation">{</span>参数key<span class="token punctuation">}</span><span class="token operator">:</span><span class="token punctuation">{</span>查询值<span class="token punctuation">}</span>

curl <span class="token operator">--</span>location <span class="token operator">--</span>request GET <span class="token string">'http://localhost:9200/course/_doc/_search?q=name:java'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h3 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h3> <ol><li><p>字符串类型</p> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/text.html" target="_blank" rel="noopener noreferrer">Elasticsearch 指南 [6.8] - 文本数据类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>字符串 <code>string</code> 可被分为 <code>text</code> 和 <code>keyword</code> 类型。若不为索引指定映射，6.x 版本的 es 会把字符串定义为 <strong>text</strong>类型，并增加一个<strong>keyword</strong>的类型字段。</p> <p>1.1 text</p> <p>文本数据类型，该类型下字符串会被分词，并根据字符串内容生成倒排索引，便于查询。主要用于适合分词查询的场景。</p> <ul><li><p>analyzer</p> <p>text类型支持分词，可通过 analyzer 属性指定分词器。</p> <p>比如：指定参数的字段类型为text，设置 IK 分词器的分词模式。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
	<span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上边指定在索引（动词）和搜索的时候都进行细粒度分词。单独定义搜索时使用的分词级别可设置<code>search_analyzer</code>属性。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
	<span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;search_analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_smart&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里指定在索引的时候使用细粒度分词，在查询的时候使用粗粒度。（可提高查询精度）</p></li> <li><p>index</p> <p>可以通过设置 index 属性指定字段是否索引。</p> <p>默认为 <code>index = true</code>，即都需要索引。设置字段需要索引，字段对应信息才会在索引库生成。</p> <p>当有些字段不需要索引时（图片，邮箱等），就可以通过设置 index 实现。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;pic&quot;:{
	&quot;type&quot;:&quot;text&quot;,
	&quot;index&quot;:false
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <p>1.2 keyword</p> <p>关键字数据类型，该类型字符串不会被分词，主要用于准确匹配的字符串。比如身份证号、邮箱地址等。查询的时候只能根据完整字符串查询。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  &quot;name&quot;:{
   &quot;type&quot;:&quot;keyword&quot;
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>数值类型</p> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/number.html#number" target="_blank" rel="noopener noreferrer">Elasticsearch 指南 [6.8] - 数字数据类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>es 支持以下数字类型。</p> <p>![image-20210630150551353](/Users/yangjunwei/Library/Application Support/typora-user-images/image-20210630150551353.png)</p> <ul><li><p>为了提高搜索效率，应尽可能选择范围小的数值类型。</p></li> <li><p>选择浮点数的时候，尽量使用比例因子。</p> <p>比如价格信息，单位为元，将比例因子设置为 100 的话 es 会按照分存储。比如输入价格23.123元，存入 es 中会按照 21134 存储。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scaled_float&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;scaling_factor&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>选用比例因子的好处就是比浮点数容易计算，更容易压缩，节省磁盘空间。</p></li></ul></li> <li><p>日期类型</p> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/date.html" target="_blank" rel="noopener noreferrer">Elasticsearch 指南 [6.8]-日期数据类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>日期类型不用分词，通常日期类型用于排序等操作。</p> <ul><li><p>format</p> <p>日期格式可以通过 format 自定义，但如果没有<code>format</code>指定，则使用默认值：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token string">&quot;strict_date_optional_time||epoch_millis&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这意味着它将接受带有可选时间戳的日期，这些时间戳符合<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/mapping-date-format.html#strict-date-time" target="_blank" rel="noopener noreferrer"><code>strict_date_optional_time</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 纪元以来的毫秒数支持的格式。</p> <p>在设置字段的时候可以通过 format 设置日期格式。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span> 
  <span class="token string">&quot;properties&quot;</span><span class="token operator">:</span> 
  	<span class="token punctuation">{</span> 
      <span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span> 
      	<span class="token punctuation">{</span> 	
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy‐MM‐dd HH:mm:ss||yyyy‐MM‐dd&quot;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>对应插入文档的参数为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018‐07‐04 18:28:58&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ol> <h3 id="分词机制"><a href="#分词机制" class="header-anchor">#</a> 分词机制</h3> <p>IK 分词器默认有两种分词模式，还支持自定义词库。</p> <p>一种是粗粒度分词 <code>ik_smart</code> ，另一种是细粒度分词 <code>ik_max_word</code>。</p> <ul><li><p><code>ik_smart</code></p> <p>会将文本进行<strong>粗粒度</strong>拆分。</p> <p>![image-20210630105757378](/Users/yangjunwei/Library/Application Support/typora-user-images/image-20210630105757378.png)</p></li> <li><p><code>ik_max_word</code></p> <p>会将文本进行<strong>细粒度</strong>拆分。</p> <p>![image-20210630105817693](/Users/yangjunwei/Library/Application Support/typora-user-images/image-20210630105817693.png)</p></li></ul> <h3 id="倒排索引-重要"><a href="#倒排索引-重要" class="header-anchor">#</a> 倒排索引 （重要）</h3> <p>https://lanffy.github.io/2019/05/10/Inverted-Index-In-Elasticsearch</p> <p><a href="https://blog.csdn.net/hguisu/article/details/7962350" target="_blank" rel="noopener noreferrer">搜索引擎-倒排索引基础知识<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>MySQL ：查找包含的值。先查到行数据，再查看行数据是否包含查找值。</p> <p>倒排索引：查找包含的值。先找到该值，查看包含该值的文档。（每个文档都要被分词）</p></blockquote> <p>![image-20210624212136428](/Users/yangjunwei/Library/Application Support/typora-user-images/image-20210624212136428.png)</p> <h2 id="四、dsl-查询"><a href="#四、dsl-查询" class="header-anchor">#</a> 四、DSL 查询</h2> <p><img src="https://img-blog.csdnimg.cn/20200602225308707.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1bmV3Ymll,size_16,color_FFFFFF,t_70" alt=""></p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://baike.baidu.com/item/elasticsearch/3411206?fr=aladdin" target="_blank" rel="noopener noreferrer">百度百科 - elasticsearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>[<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html" target="_blank" rel="noopener noreferrer">Elasticsearch: 权威指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>](https://www.elastic.co/guide/cn/elasticsearch/guide/current/mapping-intro.html)</li> <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/index.html" target="_blank" rel="noopener noreferrer">Elasticsearch Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/blueskyli/p/8326229.html" target="_blank" rel="noopener noreferrer">ElasticSearch和solr的差别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/Cobbyer/article/details/109814110" target="_blank" rel="noopener noreferrer">ES五| Elasticsearch的映射(字段类型)和分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021-07-01 08:39:18</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.86d3a547.js" defer></script><script src="/blog/assets/js/2.7ded94f8.js" defer></script><script src="/blog/assets/js/73.92a812fd.js" defer></script>
  </body>
</html>
