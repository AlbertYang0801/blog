import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.D7pKEi_Q.js";const c=JSON.parse('{"title":"资源管理和SimpleChannelInboundHandler","description":"","frontmatter":{},"headers":[],"relativePath":"frame/netty/资源管理和SimpleChannelInboundHandler.md","filePath":"frame/netty/资源管理和SimpleChannelInboundHandler.md"}'),e={name:"frame/netty/资源管理和SimpleChannelInboundHandler.md"};function h(p,s,t,k,d,r){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="资源管理和simplechannelinboundhandler" tabindex="-1">资源管理和SimpleChannelInboundHandler <a class="header-anchor" href="#资源管理和simplechannelinboundhandler" aria-label="Permalink to &quot;资源管理和SimpleChannelInboundHandler&quot;">​</a></h1><p>NIO中读写Channel数据，都使用了 Buffer，读写数据都是从 Buffer里面读取的。</p><p>而 Netty在读写网络数据时，同样也需要 Buffer。</p><p>但是这样就涉及到 Buffer的内存释放，不然会造成内存泄漏。</p><h3 id="simplechannelinboundhandler" tabindex="-1">SimpleChannelInboundHandler <a class="header-anchor" href="#simplechannelinboundhandler" aria-label="Permalink to &quot;SimpleChannelInboundHandler&quot;">​</a></h3><p>Netty实现了SimpleChannelInboundHandler类，提供 <code>channelRead0()</code> 方法，保证数据被该方法消费后自动释放数据。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> channelRead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ChannelHandlerContext ctx, Object msg) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acceptInboundMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               //读取数据</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">channelRead0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                release </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fireChannelRead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.autoRelease </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              //最终手动释放内存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ReferenceCountUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div>`,7)]))}const g=i(e,[["render",h]]);export{c as __pageData,g as default};
