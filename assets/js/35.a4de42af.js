(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{348:function(s,e,t){"use strict";t.r(e);var a=t(18),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"慢查询日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志"}},[s._v("#")]),s._v(" 慢查询日志")]),s._v(" "),e("p",[s._v("MySQL中，需要查看执行慢的SQL，需要先开启慢查询日志。")]),s._v(" "),e("p",[s._v("MySQL的慢查询日志，记录了MySQL中响应时间超过阈值的SQL语句。")]),s._v(" "),e("h2",{attrs:{id:"参数说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("slow_query_log")]),s._v("：是否开启慢查询日志，1表示开启，0表示关闭。")]),s._v(" "),e("li",[e("strong",[s._v("log-slow-queries")]),s._v(" ：旧版（5.6以下版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log")]),s._v(" "),e("li",[e("strong",[s._v("slow-query-log-file")]),s._v("：新版（5.6及以上版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log")]),s._v(" "),e("li",[e("strong",[s._v("long_query_time")]),s._v("：慢查询阈值，当查询时间多于设定的阈值时，记录日志。")]),s._v(" "),e("li",[e("strong",[s._v("log_queries_not_using_indexes")]),s._v("：未使用索引的查询也被记录到慢查询日志中（可选项）。")]),s._v(" "),e("li",[e("strong",[s._v("log_output")]),s._v("：日志存储方式。\n"),e("ul",[e("li",[s._v("log_output = "),e("code",[s._v("FILE")]),s._v("  表示将日志存入文件，默认值是 "),e("code",[s._v("FILE")]),s._v("。")]),s._v(" "),e("li",[s._v("log_output = "),e("code",[s._v("TABLE")]),s._v("表示将日志存入数据库")])])])]),s._v(" "),e("h2",{attrs:{id:"命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),e("h3",{attrs:{id:"阈值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#阈值"}},[s._v("#")]),s._v(" 阈值")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("long_query_time")])]),s._v(" "),e("p",[s._v("慢查询执行时间阈值，默认10s，单位为 S。")])]),s._v(" "),e("li",[e("p",[s._v("查看阈值")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SHOW VARIABLES LIKE '%long_query_time%';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("临时设置阈值")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("set global long_query_time = 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("h3",{attrs:{id:"查看慢查询日志状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看慢查询日志状态"}},[s._v("#")]),s._v(" 查看慢查询日志状态")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SHOW VARIABLES LIKE '%slow_query_log%';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://s2.loli.net/2025/06/16/j8b6Ge9R7JYQmAL.png",alt:""}})]),s._v(" "),e("h3",{attrs:{id:"临时开启慢查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#临时开启慢查询"}},[s._v("#")]),s._v(" 临时开启慢查询")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("set global slow_query_log = 'ON'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"记录未走索引的sql语句"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#记录未走索引的sql语句"}},[s._v("#")]),s._v(" 记录未走索引的SQL语句")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("set global log_queries_not_using_indexes='ON'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[s._v("#")]),s._v(" 日志")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- Time: 2024-08-06T10:01:47.429437Z\n- User@Host: buynow[buynow] @  [10.10.102.82]  Id: 877264\n- Query_time: 0.000210  Lock_time: 0.000070 Rows_sent: 0  Rows_examined: 1\nSET timestamp=1722938507;\nselect a.PROJECT_KEY from sys_project a,sys_project_datacenter_clusters b where b.dc_clusters_id = 1 and a.PROJECT_ID = b.PROJECT_ID and a.DELETE_FLAG = 0 ORDER BY a.PROJECT_ID;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("慢日志的"),e("code",[s._v("Rows_examined")]),s._v("：执行该SQL，实际扫描的行数，真实值")]),s._v(" "),e("li",[s._v("慢日志的"),e("code",[s._v("Rows_sent")]),s._v("：执行该SQL，实际返回的行数")])]),s._v(" "),e("h2",{attrs:{id:"参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.jb51.net/database/316849tuq.htm",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.jb51.net"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);