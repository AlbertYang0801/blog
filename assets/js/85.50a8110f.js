(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{442:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"垃圾回收"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收"}},[s._v("#")]),s._v(" 垃圾回收")]),s._v(" "),a("h2",{attrs:{id:"如何判断对象可以回收"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何判断对象可以回收"}},[s._v("#")]),s._v(" 如何判断对象可以回收")]),s._v(" "),a("h3",{attrs:{id:"引用计数法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引用计数法"}},[s._v("#")]),s._v(" 引用计数法")]),s._v(" "),a("p",[s._v("为对象添加引用计数器，如果对象被其它对象引用一次，计数器 +1；对应引用释放，则计数器 -1；只有当计数器为 0 时该对象才会被垃圾回收。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("引用计数法造成的内存泄漏")])]),s._v(" "),a("p",[s._v("像下面这种即使对象不被其它对象引用，这两个对象也一直不会被回收，因为对象A和B之间存在引用关系，引用计数器一直为 1，这样就导致了内存泄露。")]),s._v(" "),a("blockquote",[a("p",[s._v("虚拟机一般不采用该方法判断对象是否可以回收，因为对于")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/image-20220411213401200.png",alt:"image-20220411213401200"}})]),s._v(" "),a("h3",{attrs:{id:"可达性分析算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可达性分析算法"}},[s._v("#")]),s._v(" 可达性分析算法")]),s._v(" "),a("blockquote",[a("p",[s._v("如果某个对象到GC Roots间没有任何引用链相连， 或者用图论的话来说就是从GC Roots到这个对象不可达时，则证明此对象是不可能再被使用的。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5Cyjw%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220417171831000.png",alt:"image-20220417171831000"}})]),s._v(" "),a("h4",{attrs:{id:"什么是gc-roots对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是gc-roots对象"}},[s._v("#")]),s._v(" 什么是GC Roots对象？")]),s._v(" "),a("p",[s._v("能被当成 GC Roots 对象的有以下几种：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("虚拟机栈中的引用对象（方法中的引用对象，对应栈帧中的局部变量表），比如方法中的参数、局部变量、临时变量。")]),s._v(" "),a("blockquote",[a("p",[s._v("栈帧中的局部变量表里的引用变量，真实对象存在于堆内存中，作为引用对象保证了堆内存中的对象不会被垃圾回收，因为它有被引用。")])])]),s._v(" "),a("li",[a("p",[s._v("方法区中类的静态属性引用的对象，比如类中的引用类型的静态变量。")]),s._v(" "),a("blockquote",[a("p",[s._v("方法区中的静态属性是引用变量时，引用的也是堆内存中的对象，能保证引用的堆内存中的对象不会被垃圾回收。")])])]),s._v(" "),a("li",[a("p",[s._v("方法区中常量引用的对象，比如字符串中常量池（StringTable）的引用。")]),s._v(" "),a("blockquote",[a("p",[s._v("StringTable 持有对堆内存中字符串对象的引用，能保证字符串对象不会被垃圾回收。")])])]),s._v(" "),a("li",[a("p",[s._v("本地方法栈中 JNI （Native方法）引用的对象。")]),s._v(" "),a("blockquote",[a("p",[s._v("本地方法栈中若持有了堆内存对象的引用，也可以保证对内存对象不被回收。")])])]),s._v(" "),a("li",[a("p",[s._v("所有被同步锁（synchronized关键字）持有的对象。")])]),s._v(" "),a("li",[a("p",[s._v("Java虚拟机内部的引用。")]),s._v(" "),a("blockquote",[a("p",[s._v("如基本数据类型对应的Class对象，一些常驻的异常对象（比如 NullPointExcepiton、OutOfMemoryError）等，还有系统类加载器。")])])])]),s._v(" "),a("h3",{attrs:{id:"引用的四种类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引用的四种类型"}},[s._v("#")]),s._v(" 引用的四种类型")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("强引用")]),s._v(" "),a("p",[s._v("强应用就是引用赋值，只要引用关系还在，垃圾回收就不将对象回收。")]),s._v(" "),a("p",[a("strong",[s._v("永远不会回收")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("软引用")]),s._v(" "),a("p",[s._v("软引用关联的对象，会在系统发生内存溢出前，强制进行回收。若回收完软引用关联的对象，内存依然不足，才会报出内存溢出。")]),s._v(" "),a("p",[s._v("通过 SoftReference 实现软引用。")]),s._v(" "),a("p",[a("strong",[s._v("发生内存溢出前会进行回收")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("弱引用")]),s._v(" "),a("p",[s._v("弱引用关联的对象，只能生存到下一次垃圾回收发生为止。当垃圾回收的时候，无论内存是否足够，弱引用关联的对象都会被回收。")]),s._v(" "),a("p",[s._v("通过 WeakReference 实现弱引用（ ThreadLoadl 防止内存溢出就使用了弱引用）。")]),s._v(" "),a("p",[a("strong",[s._v("垃圾回收时会进行回收")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("虚引用")]),s._v(" "),a("p",[s._v("虚引用是最弱的一种引用关系，一个对象是否存在虚引用，跟对象的生存时间没关系，也无法通过虚引用获取对象实例。")]),s._v(" "),a("p",[s._v("为对象设置虚引用的唯一目的只是为了该对象在被垃圾回收的时候得到系统的通知。")]),s._v(" "),a("p",[s._v("通过 PhantomReference 实现虚引用。")]),s._v(" "),a("p",[a("strong",[s._v("跟垃圾回收时机无关")]),s._v("，只是为了垃圾回收时得到系统通知。")])])]),s._v(" "),a("h3",{attrs:{id:"终结器引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#终结器引用"}},[s._v("#")]),s._v(" 终结器引用")]),s._v(" "),a("p",[s._v("终结器引用用以对象实现的 "),a("code",[s._v("finalize()")]),s._v(" 方法为主，因为该方法能够实现对象的自我拯救，比如在该方法里面将自己赋值给某个 GC Roots 对象得引用等。")]),s._v(" "),a("p",[s._v("在可达性分析算法分析后判断不可达的对象，并不会直接判定对象可回收。而是判断对象是否需要执行 "),a("code",[s._v("finalize()")]),s._v(" 方法，如果执行了该方法之后仍然没有引用，才会真的被回收掉。")]),s._v(" "),a("p",[a("em",[s._v("当对象没有重写 "),a("code",[s._v("finalize()")]),s._v("方法和 "),a("code",[s._v("finalize()")]),s._v("方法已经被调用过一次时，是不会执行。")])]),s._v(" "),a("div",{staticClass:"language-JAVA line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeGc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeGc")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAlive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("finalize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("finalize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"finalize method executed!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//自我拯救")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeGc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SneakyThrows")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeGc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("save"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAlive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//只能执行一次，第二次无效")]),s._v("\n        save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("save"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAlive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//finalize method executed!")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//no")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("h2",{attrs:{id:"垃圾回收算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收算法"}},[s._v("#")]),s._v(" 垃圾回收算法")]),s._v(" "),a("h3",{attrs:{id:"三种回收算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三种回收算法"}},[s._v("#")]),s._v(" 三种回收算法")]),s._v(" "),a("ol",[a("li",[s._v("标记清除")]),s._v(" "),a("li",[s._v("标记整理")]),s._v(" "),a("li",[s._v("复制算法")])]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5Cyjw%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220414225123308.png",alt:"image-20220414225123308"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/image-20220414225137032.png",alt:"image-20220414225137032"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/image-20220414225154606.png",alt:"image-20220414225154606"}})]),s._v(" "),a("h3",{attrs:{id:"分代回收算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分代回收算法"}},[s._v("#")]),s._v(" 分代回收算法")]),s._v(" "),a("p",[s._v("JVM 采用的是"),a("strong",[s._v("分代回收算法")]),s._v("，即不同的分区使用的回收算法不一样。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/image-20220414230136867.png",alt:"image-20220414230136867"}})]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("年轻代")])])]),s._v(" "),a("p",[s._v("​\t\t年轻代采用的是"),a("strong",[s._v("复制算法")]),s._v("。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("老年代")]),s._v(" "),a("p",[s._v("Old区采用"),a("strong",[s._v("标记整理")]),s._v("算法。")]),s._v(" "),a("p",[a("em",[s._v("在老年代中存储的类生命周期都较长或者为大对象，不适合用复制算法。")])])])]),s._v(" "),a("h3",{attrs:{id:"垃圾回收流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收流程"}},[s._v("#")]),s._v(" 垃圾回收流程")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/image-20220414231104031.png",alt:"image-20220414231104031"}})]),s._v(" "),a("h4",{attrs:{id:"_1-新对象生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-新对象生成"}},[s._v("#")]),s._v(" 1. 新对象生成")]),s._v(" "),a("p",[s._v("新创建的对象默认是会分配到年轻代的Eden区，若是大对象则是直接分配到老年代。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("#限制大对象的大小\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PretenureSizeThreshold")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_2-年轻代垃圾回收"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-年轻代垃圾回收"}},[s._v("#")]),s._v(" 2. 年轻代垃圾回收")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("新生成的对象放到 Eden 区。")])]),s._v(" "),a("li",[a("p",[s._v("Eden 区满了之后触发 MinorGC，对 Eden 进行复制回收。")]),s._v(" "),a("ul",[a("li",[s._v("不存活的对象被垃圾回收。")]),s._v(" "),a("li",[s._v("Eden区和form区存活的对象复制到to区，对象年龄加 1。并且交换from区和to区。")]),s._v(" "),a("li",[s._v("MinorGC 会暂停其它用户线程，等垃圾回收结束，才会恢复用户线程。")])])]),s._v(" "),a("li",[a("p",[s._v("当对象年龄到达一个阈值。对象会被放到老年代中。")]),s._v(" "),a("blockquote",[a("p",[s._v("新生代年龄阈值默认是15（4bit，最大表示为 1111 ）。")]),s._v(" "),a("p",[s._v("-XX：MaxTenuringThreshold")])])])]),s._v(" "),a("h4",{attrs:{id:"_3-老年代垃圾回收-fullgc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-老年代垃圾回收-fullgc"}},[s._v("#")]),s._v(" 3. 老年代垃圾回收-fullGC")]),s._v(" "),a("p",[a("strong",[s._v("老年代对象有以下几种情况：")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("大对象直接放入老年代。")])]),s._v(" "),a("li",[a("p",[s._v("年轻代垃圾回收年龄到达限制，晋升到老年代。")])]),s._v(" "),a("li",[a("p",[s._v("发生 MinorGC时候，to 区放不下复制的对象，就会把对象放到老年代中。")])]),s._v(" "),a("li",[a("p",[s._v("动态对象年龄判定")])])]),s._v(" "),a("blockquote",[a("p",[s._v("在From空间中，相同年龄所有对象的大小总和大于Survivor空间的一半，那么年龄大于等于该年龄的对象就会被移动到老年代，而不用等到15岁(默认)：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20191030105149992.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("老年代的垃圾回收-FullGC")])]),s._v(" "),a("p",[a("em",[s._v("老年代的对象存储的比年轻代多，而且存在较多大对象。对老年代进行垃圾回收时，不适合复制算法。适合的是"),a("strong",[s._v("标记整理")]),s._v("算法。标记出存活对象，将所有存活对象向一端移动，来保证内存的连续性。")])]),s._v(" "),a("p",[s._v("在发生MinorGC 时，虚拟机会检查每次晋升进入老年代的大小是否大于老年代的剩余空间大小，如果大于，则直接触发一次Full GC。")]),s._v(" "),a("blockquote",[a("p",[s._v("否则，就查看是否设置了-XX:+HandlePromotionFailure（允许担保失败），如果允许，则只会进行MinorGC，此时可以容忍内存分配失败；**如果不允许，则仍然进行Full GC（**这代表着如果设置-XX:+Handle PromotionFailure，则触发MinorGC就会同时触发Full GC，哪怕老年代还有很多内存，所以，最好不要这样做）。（待验证）")])]),s._v(" "),a("p",[a("strong",[s._v("FullGC触发条件")])]),s._v(" "),a("ul",[a("li",[s._v("老年代空间不足")]),s._v(" "),a("li",[s._v("方法区空间不足")]),s._v(" "),a("li",[s._v("通过Minor GC后进入老年代的平均大小大于老年代的可用内存。")]),s._v(" "),a("li",[s._v("由Eden区、From Space区向To Space区复制时，对象大小大于To Space可用内存，则把该对象转存到老年代，且老年代的可用内存小于该对象大小。")])]),s._v(" "),a("p",[s._v("https://blog.csdn.net/weixin_42615068/article/details/102813947")]),s._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844903909983535111#heading-8",target:"_blank",rel:"noopener noreferrer"}},[s._v("JDK内存模型"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);