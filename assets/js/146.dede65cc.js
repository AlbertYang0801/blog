(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{458:function(t,s,a){"use strict";a.r(s);var r=a(18),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"cpu负载过高排查记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpu负载过高排查记录"}},[t._v("#")]),t._v(" CPU负载过高排查记录")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/lijie1051/article/details/128464838",target:"_blank",rel:"noopener noreferrer"}},[t._v("解决线上微服务容器cpu占用100%问题（java进程占用100%问题）_容器cpu占用高_上树的蜗牛儿的博客-CSDN博客"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"平台发现问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#平台发现问题"}},[t._v("#")]),t._v(" 平台发现问题")]),t._v(" "),s("p",[t._v("平台发现集群节点 node219 CPU利用率过高。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/Ub4zn7Pw3YM6Evl.png",alt:"image.png"}})]),t._v(" "),s("p",[t._v("通过查看该节点下的 pod 发现，bookdemo 使用 CPU 过高。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/pT5ohk7ftYPECGU.png",alt:"image.png"}})]),t._v(" "),s("h2",{attrs:{id:"主机排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主机排查"}},[t._v("#")]),t._v(" 主机排查")]),t._v(" "),s("h3",{attrs:{id:"top-查看进程情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#top-查看进程情况"}},[t._v("#")]),t._v(" top 查看进程情况")]),t._v(" "),s("p",[t._v("使用 top 确认占用cpu过高的进程。")]),t._v(" "),s("p",[t._v("PID=17177 占用 CPU 最高。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/KoI7m1SMUPerxW4.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"查看进程-pid-对应的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看进程-pid-对应的容器"}},[t._v("#")]),t._v(" 查看进程 PID 对应的容器")]),t._v(" "),s("p",[t._v("由于该进程是个POD，需要找到对应容器，进入容器内部排查线程情况。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/KocELWP9Chysi2f.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/fWkvhgDpCyUju9w.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"容器内部排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器内部排查"}},[t._v("#")]),t._v(" 容器内部排查")]),t._v(" "),s("h3",{attrs:{id:"top查看进程情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#top查看进程情况"}},[t._v("#")]),t._v(" top查看进程情况")]),t._v(" "),s("p",[t._v("可以看到 PID=1 进程使用CPU过高。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/TRfVYGOBQAHukyC.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"查看进程的线程资源情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看进程的线程资源情况"}},[t._v("#")]),t._v(" 查看进程的线程资源情况")]),t._v(" "),s("p",[t._v("根据 PID = 1 查看该进程下的线程情况。")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("top -H -p1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/rzfWVbpwZsy1R8g.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到有8个线程 CPU 使用率非常高。")]),t._v(" "),s("h3",{attrs:{id:"jstack查看进程堆栈信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jstack查看进程堆栈信息"}},[t._v("#")]),t._v(" jstack查看进程堆栈信息")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("jstack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17177")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("输出结果到文件")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("jstack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17177")]),t._v(" > java.log\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"查看某个线程堆栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看某个线程堆栈"}},[t._v("#")]),t._v(" 查看某个线程堆栈")]),t._v(" "),s("p",[t._v("比如查看线程 PID=1911 的堆栈。")]),t._v(" "),s("blockquote",[s("p",[t._v("堆栈里面的 id 是16进制，需要将拿到的 线程PID转换为16进制。比如 1911的16进制是 777。")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://jisuan5.com/decimal/?hex=1911",target:"_blank",rel:"noopener noreferrer"}},[t._v("十进制转换 - 在线进制转换器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("可以看到堆栈信息中该线程的标识是 "),s("code",[t._v("nid=0x777")]),t._v("，可以根据该标识过滤。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/G65zLyHxJDkUphr.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("cat java.log | grep 'nid=0x777' -C "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/WzcMReCoy5qpE8j.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到代码关键位置，通过排查代码作进一步排查。")]),t._v(" "),s("h3",{attrs:{id:"通过堆栈信息排查死锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过堆栈信息排查死锁"}},[t._v("#")]),t._v(" 通过堆栈信息排查死锁")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("cat java.log |grep 'deadlock' -C "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/05/29/AidVDvC42GIkTtQ.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到线程1 和 线程2 互相持有对方需要的锁，可以看到对应代码位置。")]),t._v(" "),s("p",[t._v("通过 lockId 可以快速查找该锁被谁持有。")])])}),[],!1,null,null,null);s.default=e.exports}}]);