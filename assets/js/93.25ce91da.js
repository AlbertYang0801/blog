(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{405:function(a,s,t){"use strict";t.r(s);var n=t(18),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"spring如何解决循环依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring如何解决循环依赖"}},[a._v("#")]),a._v(" Spring如何解决循环依赖")]),a._v(" "),s("h2",{attrs:{id:"依赖注入的四种方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖注入的四种方法"}},[a._v("#")]),a._v(" 依赖注入的四种方法")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("构造方法注入")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloService")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("helloService "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("工厂方法注入")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("initMethod "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"init"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" destroyMethod "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"destory"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloB")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("helloB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloService")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("set方法注入")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setHelloService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloService")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("helloService "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("字段注入")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloService")]),a._v(" helloService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])]),a._v(" "),s("h3",{attrs:{id:"循环依赖的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#循环依赖的问题"}},[a._v("#")]),a._v(" 循环依赖的问题")]),a._v(" "),s("p",[a._v("其中构造方法注入和工厂方法注入是强依赖，因为Bean创建和属性注入放到一起了。")]),a._v(" "),s("p",[a._v("比如构造方法注入，创建对象的同时进行属性注入，这种属于强依赖。")]),a._v(" "),s("p",[a._v("而强依赖是解决不了循环依赖的问题的，因为创建对象和属性注入属于一体不可分的。")]),a._v(" "),s("p",[a._v("我们解决循环依赖是先创建对象，然后属性注入的时候利用三级缓存解决的。")]),a._v(" "),s("h2",{attrs:{id:"循环依赖分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#循环依赖分析"}},[a._v("#")]),a._v(" 循环依赖分析")]),a._v(" "),s("p",[s("img",{attrs:{src:"Spring0c673815-8e8c-4dca-ab06-1de85f1373ccSpring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%963adb8787-2ee9-4cd4-abd7-ce590478b45620210315164906.png",alt:""}})]),a._v(" "),s("p",[a._v("在创建 Bean 的过程中，有依赖注入的过程。")]),a._v(" "),s("p",[a._v("这个阶段会发生循环依赖。")]),a._v(" "),s("p",[s("em",[a._v("ABean创建–>依赖了B属性–>触发BBean创建—>B依赖了A属性—>需要ABean（但ABean还在创建过程中）")])]),a._v(" "),s("h2",{attrs:{id:"依赖场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖场景"}},[a._v("#")]),a._v(" 依赖场景")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("构造器注入循环依赖")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("B")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("B")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("B")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//A a = new A(new B(new A(new B(new A()))));")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[s("strong",[a._v("构造器的循环依赖Spring是无法解决的。")])]),a._v(" "),s("p",[a._v("因为Spring解决循环依赖是在对象实例化之后，依赖注入时解决的。")]),a._v(" "),s("p",[a._v("构造器对应的是"),s("strong",[a._v("实例化阶段")]),a._v("，无法解决循环依赖。")]),a._v(" "),s("p",[a._v("强依赖是无法解决循环依赖的问题的，因为Bean对象创建和属性注入是一个阶段。我们解决循环依赖是分为两个阶段，创建对象和属性注入，在属性注入时可以解决循环依赖。")])]),a._v(" "),s("li",[s("p",[a._v("依赖注入")]),a._v(" "),s("p",[a._v("利用三级缓存可以解决。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("B")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("B")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("Prototype类的循环依赖")]),a._v(" "),s("p",[a._v("无法解决，因为 Prototype作用域的类不会放到缓存中，Spring通过缓存解决循环依赖。")])])]),a._v(" "),s("h2",{attrs:{id:"懒加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#懒加载"}},[a._v("#")]),a._v(" 懒加载")]),a._v(" "),s("h3",{attrs:{id:"懒加载的工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#懒加载的工作原理"}},[a._v("#")]),a._v(" 懒加载的工作原理")]),a._v(" "),s("p",[a._v("当一个懒加载的 bean需要被初始化时，Spring会创建一个代理对象（通常是CGLIB 字节码动态代理）。")]),a._v(" "),s("p",[a._v("这个代理对象可以在其它类需要的时候，通过代理对象调用实际对象的方法。")]),a._v(" "),s("p",[a._v("而实际Bean在第一次使用的时候才会创建。")]),a._v(" "),s("h3",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[a._v("#")]),a._v(" 使用方式")]),a._v(" "),s("p",[a._v("@Lazy")]),a._v(" "),s("h2",{attrs:{id:"三级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三级缓存"}},[a._v("#")]),a._v(" 三级缓存")]),a._v(" "),s("p",[a._v("Spring引入三级缓存解决依赖注入和set方法注入可能导致的循环依赖")]),a._v(" "),s("p",[s("img",{attrs:{src:"Spring0c673815-8e8c-4dca-ab06-1de85f1373ccSpring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%963adb8787-2ee9-4cd4-abd7-ce590478b456image.png",alt:""}})]),a._v(" "),s("ul",[s("li",[s("p",[s("code",[a._v("singletonObjects")])]),a._v(" "),s("p",[a._v("单例池，缓存的是已经"),s("strong",[a._v("经历了完整生命周期的Bean对象")]),a._v("。")]),a._v(" "),s("p",[s("strong",[a._v("已经实例化并且已经属性赋值。")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("earlySingletonObjects")])]),a._v(" "),s("p",[a._v("二级缓存，缓存的是"),s("strong",[a._v("早期的 Bean 对象")]),a._v("，Bean的生命周期还没走完就放入了二级缓存。")]),a._v(" "),s("p",[s("strong",[a._v("已经实例化但是还未属性赋值。可以存放原对象，也可能存放代理对象。")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("singletonFactories")])]),a._v(" "),s("p",[a._v("三级缓存，缓存的是ObjectFactory，表示对象工厂，用来创建早期 Bean对象的工厂，可以通过该工厂创建出代理对象。")])])]),a._v(" "),s("h3",{attrs:{id:"为什么引入二级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么引入二级缓存"}},[a._v("#")]),a._v(" 为什么引入二级缓存")]),a._v(" "),s("p",[a._v("在循环依赖场景 A→B→A 中，实例化之后将A对象放到二级缓存中，这样 B 需要引用 A 时，从二级缓存获取就可以了。")]),a._v(" "),s("p",[a._v("Bean 实例化之后，整个 Bean生命周期 "),s("strong",[a._v("Bean对象的堆内存地址都不会改变")]),a._v("。所以 B依赖的A（缓存）和走完生命周期的 A是一个对象。")]),a._v(" "),s("p",[s("img",{attrs:{src:"Spring0c673815-8e8c-4dca-ab06-1de85f1373ccSpring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%963adb8787-2ee9-4cd4-abd7-ce590478b456image_1.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"为什么引入三级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么引入三级缓存"}},[a._v("#")]),a._v(" 为什么引入三级缓存")]),a._v(" "),s("p",[a._v("为了解决 AOP对象引入三级缓存。")]),a._v(" "),s("p",[a._v("Bean创建的生命周期可以简化为 "),s("strong",[a._v("实例化 → 依赖注入 → AOP")]),a._v("。")]),a._v(" "),s("p",[a._v("AOP之后 Bean 实际上生成了一个代理对象，该代理对象和二级缓存里面存放的对象不是一个对象。这样就会导致 B 依赖的是 A的原始对象，但是需要的是 A的代理对象。")]),a._v(" "),s("h3",{attrs:{id:"三级缓存的内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三级缓存的内容"}},[a._v("#")]),a._v(" 三级缓存的内容")]),a._v(" "),s("p",[a._v("三级缓存，缓存的是ObjectFactory，其实就是 一个函数式接口。")]),a._v(" "),s("p",[s("code",[a._v("() -> getEarlyBeanReference(beanName, mbd,bean)")])]),a._v(" "),s("p",[a._v("作用是能通过该函数获取一个对象的代理对象。")]),a._v(" "),s("ul",[s("li",[a._v("如果对象有 AOP，返回的就是 AOP 之后的代理对象。")]),a._v(" "),s("li",[a._v("如果对象没有 AOP，返回原对象。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"Spring0c673815-8e8c-4dca-ab06-1de85f1373ccSpring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%963adb8787-2ee9-4cd4-abd7-ce590478b456image_2.png",alt:""}})]),a._v(" "),s("p",[a._v("注意：调用该函数不是在放入三级缓存的时候。")]),a._v(" "),s("h3",{attrs:{id:"三级缓存的执行流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三级缓存的执行流程"}},[a._v("#")]),a._v(" 三级缓存的执行流程")]),a._v(" "),s("ol",[s("li",[a._v("A 实例化。")]),a._v(" "),s("li",[a._v("将 A 对应的 "),s("code",[a._v("ObjectFactory")]),a._v(" 放入三级缓存中。")]),a._v(" "),s("li",[a._v("依赖 B → 创建B → 实例化 B → 依赖 A。\n"),s("ol",[s("li",[a._v("从三级缓存获取 A 对应的 ObjectFactory。")]),a._v(" "),s("li",[a._v("通过 ObjectFactory 获取代理对象 A+(如果没有AOP，A+就是原对象)。")]),a._v(" "),s("li",[a._v("将代理对象 A+ 放到二级缓存，并且移除三级缓存中对应的 "),s("code",[a._v("ObjectFactory")]),a._v("。")]),a._v(" "),s("li",[a._v("B 读取二级缓存中的 A+，完成依赖注入。")]),a._v(" "),s("li",[a._v("清除二级缓存中的 B，然后将 B 放到一级缓存。")])])]),a._v(" "),s("li",[a._v("B 注入完成之后，A完成依赖注入。")]),a._v(" "),s("li",[a._v("继续 A 的生命周期。")]),a._v(" "),s("li",[a._v("判断 A 是否需要 AOP。")])]),a._v(" "),s("ul",[s("li",[a._v("如果需要 AOP，从二级缓存（earlySingletonObjects）中获取对象 A+，放入一级缓存。")]),a._v(" "),s("li",[a._v("如果不需要 AOP，将 A 放入一级缓存，并从二级缓存移除 A。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);