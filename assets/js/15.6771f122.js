(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{374:function(a,s,t){"use strict";t.r(s);var e=t(26),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"内存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存淘汰策略"}},[a._v("#")]),a._v(" 内存淘汰策略")]),a._v(" "),t("h2",{attrs:{id:"最大内存设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大内存设置"}},[a._v("#")]),a._v(" 最大内存设置")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("redis 默认内存是多少？")]),a._v(" "),t("p",[a._v("在 64 位操作系统不限制内存大小，在 32 位操作系统下最多使用 3GB。")])]),a._v(" "),t("li",[t("p",[a._v("查看 redis 最大内存？")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("config get maxmemory\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725230010.png",alt:"image-20210725225656431"}})])]),a._v(" "),t("li",[t("p",[a._v("修改 redis 内存大小？")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("修改配置文件")]),a._v(" "),t("p",[a._v("在 "),t("code",[a._v("redis.conf")]),a._v(" 第 859 行可以设置最大内存大小（单位是字节）。")]),a._v(" "),t("blockquote",[t("p",[a._v(": set nu 可以显示文件行号")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725222546.png",alt:"image-20210725222546949"}})])]),a._v(" "),t("li",[t("p",[a._v("使用命令配置")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" maxmemory "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725225927.png",alt:"image-20210725225927031"}})])])])]),a._v(" "),t("li",[t("p",[a._v("redis 内存满了之后会怎样?")]),a._v(" "),t("p",[a._v("采用内存淘汰策略，默认是 "),t("code",[a._v("no-enviction")]),a._v("，会抛出 OOM 异常。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725230125.png",alt:"image-20210725230125654"}})])]),a._v(" "),t("li",[t("p",[a._v("查看内存信息")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("info memory\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725230742.png",alt:"image-20210725230742686"}})])]),a._v(" "),t("li",[t("p",[a._v("生产上一般怎么设置内存？")]),a._v(" "),t("p",[a._v("推荐设置内存为"),t("strong",[a._v("最大物理内存的四分之三")]),a._v("。")])])]),a._v(" "),t("hr"),a._v(" "),t("h2",{attrs:{id:"redis内存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis内存淘汰策略"}},[a._v("#")]),a._v(" redis内存淘汰策略")]),a._v(" "),t("h3",{attrs:{id:"八种内存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八种内存淘汰策略"}},[a._v("#")]),a._v(" 八种内存淘汰策略")]),a._v(" "),t("p",[a._v("在 redis.conf 文件中有体现。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210725232238.png",alt:"image-20210725232238442"}})]),a._v(" "),t("ul",[t("li",[a._v("2个范围\n"),t("ul",[t("li",[a._v("所有 key。")]),a._v(" "),t("li",[a._v("设置了过期时间的 key。")])])]),a._v(" "),t("li",[a._v("4个方式\n"),t("ul",[t("li",[a._v("LRU 算法。")]),a._v(" "),t("li",[a._v("LFU 算法。")]),a._v(" "),t("li",[a._v("random - 随机删除。")]),a._v(" "),t("li",[a._v("ttl - 删除马上要过期的。")])])])]),a._v(" "),t("hr"),a._v(" "),t("ol",[t("li",[a._v("volatile-lru：对所有设置了过期时间的 key 使用 LRU 算法进行删除。")]),a._v(" "),t("li",[a._v("allkeys-lru：对所有 key 使用 LRU 算法进行删除。")]),a._v(" "),t("li",[a._v("volatile-lfu：对所有设置了过期时间的 key 使用 LFU 算法进行删除。")]),a._v(" "),t("li",[a._v("allkeys-lfu：对所有 key 使用 LFU 算法进行删除。")]),a._v(" "),t("li",[a._v("volatile-random ：对所有设置了过期时间的 key 随机删除。")]),a._v(" "),t("li",[a._v("allkeys-random ：对所有 key 随机删除。")]),a._v(" "),t("li",[a._v("volatile-ttl：删除马上要过期的 key。")]),a._v(" "),t("li",[a._v("noeviction："),t("strong",[a._v("默认的内存淘汰策略")]),a._v("，禁止删除数据，能保证数据不丢失。当内存满了的时候，再写入数据会返回错误。")])]),a._v(" "),t("h3",{attrs:{id:"设置内存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置内存淘汰策略"}},[a._v("#")]),a._v(" 设置内存淘汰策略")]),a._v(" "),t("ol",[t("li",[a._v("配置文件设置")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlbertYang0801/pic-bed@main/img/20210726004413.png",alt:"image-20210726004413838"}})]),a._v(" "),t("p",[a._v("​\t在 redis.conf 配置文件中 "),t("code",[a._v("maxmemory-policy")]),a._v(" 对应设置内存淘汰策略，注释提示了默认淘汰策略是 "),t("code",[a._v("noeviction")]),a._v("。通过修改该配置就可以修改内存淘汰策略。")]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("命令行设置")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 获取maxmemory-policy配置")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" config get maxmemory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("policy\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置maxmemory-policy配置为allkeys-lru")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" config set maxmemory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("policy allkeys"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("lru\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])])])]),a._v(" "),t("h3",{attrs:{id:"如何选择内存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何选择内存淘汰策略"}},[a._v("#")]),a._v(" 如何选择内存淘汰策略")]),a._v(" "),t("ul",[t("li",[a._v("若所有数据访问频率一样，可以使用 "),t("code",[a._v("allkeys-random")]),a._v("。")]),a._v(" "),t("li",[a._v("若有一部分是热点数据，有一部分是冷门数据，可以考虑使用 "),t("code",[a._v("allkeys-lru")]),a._v("。")]),a._v(" "),t("li",[a._v("若希望有一部分数据被长期保存，而有些可以被删除。可以选择 "),t("code",[a._v("volatile-lru")]),a._v("或 "),t("code",[a._v("volatile-random")]),a._v("。")]),a._v(" "),t("li",[a._v("若希望避免设置 key 的失效时间来减少内存的使用。可以使用 "),t("code",[a._v("allkeys-lru")]),a._v(" 搭配 key 不设置过期时间来高效利用内存。")])]),a._v(" "),t("h2",{attrs:{id:"lru算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lru算法"}},[a._v("#")]),a._v(" LRU算法")]),a._v(" "),t("h2",{attrs:{id:"lfu算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lfu算法"}},[a._v("#")]),a._v(" LFU算法")]),a._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[a._v("#")]),a._v(" 参考链接")])])}),[],!1,null,null,null);s.default=r.exports}}]);