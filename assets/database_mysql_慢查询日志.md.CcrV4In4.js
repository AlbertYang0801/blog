import{_ as e,c as s,o as n,aM as l}from"./chunks/framework.Du1sph90.js";const h=JSON.parse('{"title":"慢查询日志","description":"","frontmatter":{},"headers":[],"relativePath":"database/mysql/慢查询日志.md","filePath":"database/mysql/慢查询日志.md","lastUpdated":1752827238000}'),i={name:"database/mysql/慢查询日志.md"};function t(o,a,r,p,d,c){return n(),s("div",null,a[0]||(a[0]=[l(`<h1 id="慢查询日志" tabindex="-1">慢查询日志 <a class="header-anchor" href="#慢查询日志" aria-label="Permalink to &quot;慢查询日志&quot;">​</a></h1><p>MySQL中，需要查看执行慢的SQL，需要先开启慢查询日志。</p><p>MySQL的慢查询日志，记录了MySQL中响应时间超过阈值的SQL语句。</p><h2 id="参数说明" tabindex="-1">参数说明 <a class="header-anchor" href="#参数说明" aria-label="Permalink to &quot;参数说明&quot;">​</a></h2><ul><li><strong>slow_query_log</strong>：是否开启慢查询日志，1表示开启，0表示关闭。</li><li><strong>log-slow-queries</strong> ：旧版（5.6以下版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</li><li><strong>slow-query-log-file</strong>：新版（5.6及以上版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</li><li><strong>long_query_time</strong>：慢查询阈值，当查询时间多于设定的阈值时，记录日志。</li><li><strong>log_queries_not_using_indexes</strong>：未使用索引的查询也被记录到慢查询日志中（可选项）。</li><li><strong>log_output</strong>：日志存储方式。 <ul><li>log_output = <code>FILE</code> 表示将日志存入文件，默认值是 <code>FILE</code>。</li><li>log_output = <code>TABLE</code>表示将日志存入数据库</li></ul></li></ul><h2 id="命令" tabindex="-1">命令 <a class="header-anchor" href="#命令" aria-label="Permalink to &quot;命令&quot;">​</a></h2><h3 id="阈值" tabindex="-1">阈值 <a class="header-anchor" href="#阈值" aria-label="Permalink to &quot;阈值&quot;">​</a></h3><ul><li><p><code>long_query_time</code></p><p>慢查询执行时间阈值，默认10s，单位为 S。</p></li><li><p>查看阈值</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SHOW VARIABLES LIKE &#39;%long_query_time%&#39;;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>临时设置阈值</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>set global long_query_time = 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul><h3 id="查看慢查询日志状态" tabindex="-1">查看慢查询日志状态 <a class="header-anchor" href="#查看慢查询日志状态" aria-label="Permalink to &quot;查看慢查询日志状态&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://s2.loli.net/2025/06/16/j8b6Ge9R7JYQmAL.png" alt="" loading="lazy"></p><h3 id="临时开启慢查询" tabindex="-1">临时开启慢查询 <a class="header-anchor" href="#临时开启慢查询" aria-label="Permalink to &quot;临时开启慢查询&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>set global slow_query_log = &#39;ON&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="记录未走索引的sql语句" tabindex="-1">记录未走索引的SQL语句 <a class="header-anchor" href="#记录未走索引的sql语句" aria-label="Permalink to &quot;记录未走索引的SQL语句&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>set global log_queries_not_using_indexes=&#39;ON&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="日志" tabindex="-1">日志 <a class="header-anchor" href="#日志" aria-label="Permalink to &quot;日志&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- Time: 2024-08-06T10:01:47.429437Z</span></span>
<span class="line"><span>- User@Host: buynow[buynow] @  [10.10.102.82]  Id: 877264</span></span>
<span class="line"><span>- Query_time: 0.000210  Lock_time: 0.000070 Rows_sent: 0  Rows_examined: 1</span></span>
<span class="line"><span>SET timestamp=1722938507;</span></span>
<span class="line"><span>select a.PROJECT_KEY from sys_project a,sys_project_datacenter_clusters b where b.dc_clusters_id = 1 and a.PROJECT_ID = b.PROJECT_ID and a.DELETE_FLAG = 0 ORDER BY a.PROJECT_ID;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>慢日志的<code>Rows_examined</code>：执行该SQL，实际扫描的行数，真实值</li><li>慢日志的<code>Rows_sent</code>：执行该SQL，实际返回的行数</li></ul><h2 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-label="Permalink to &quot;参考链接&quot;">​</a></h2><p><a href="https://www.jb51.net/database/316849tuq.htm" target="_blank" rel="noreferrer">www.jb51.net</a></p>`,20)]))}const b=e(i,[["render",t]]);export{h as __pageData,b as default};
