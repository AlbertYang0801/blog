<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>锁 | 技术小站</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="logo.ico">
    <meta name="description" content="生活不止眼前的代码，还有迈向田野的步伐">
    
    <link rel="preload" href="/blog/assets/css/0.styles.803dc0c7.css" as="style"><link rel="preload" href="/blog/assets/js/app.36c7cd49.js" as="script"><link rel="preload" href="/blog/assets/js/2.5c52e41f.js" as="script"><link rel="preload" href="/blog/assets/js/1.65a7fcd1.js" as="script"><link rel="preload" href="/blog/assets/js/39.debd2e6a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a209d3a9.js"><link rel="prefetch" href="/blog/assets/js/100.41067c0c.js"><link rel="prefetch" href="/blog/assets/js/101.5e48ee63.js"><link rel="prefetch" href="/blog/assets/js/102.996da4fc.js"><link rel="prefetch" href="/blog/assets/js/103.4ad9a9ed.js"><link rel="prefetch" href="/blog/assets/js/104.dbbf376c.js"><link rel="prefetch" href="/blog/assets/js/105.474c76df.js"><link rel="prefetch" href="/blog/assets/js/106.64ee5b81.js"><link rel="prefetch" href="/blog/assets/js/107.4e2c303f.js"><link rel="prefetch" href="/blog/assets/js/108.6df8df47.js"><link rel="prefetch" href="/blog/assets/js/109.f9a6b25c.js"><link rel="prefetch" href="/blog/assets/js/11.9b471693.js"><link rel="prefetch" href="/blog/assets/js/110.cd289f4f.js"><link rel="prefetch" href="/blog/assets/js/111.de5b0344.js"><link rel="prefetch" href="/blog/assets/js/112.602ad505.js"><link rel="prefetch" href="/blog/assets/js/113.d9f1cd37.js"><link rel="prefetch" href="/blog/assets/js/114.c39c0da9.js"><link rel="prefetch" href="/blog/assets/js/115.79153770.js"><link rel="prefetch" href="/blog/assets/js/116.14b62c34.js"><link rel="prefetch" href="/blog/assets/js/117.be545b11.js"><link rel="prefetch" href="/blog/assets/js/118.50059393.js"><link rel="prefetch" href="/blog/assets/js/119.95ac2812.js"><link rel="prefetch" href="/blog/assets/js/12.a4ba3c93.js"><link rel="prefetch" href="/blog/assets/js/120.8609e349.js"><link rel="prefetch" href="/blog/assets/js/121.578e1010.js"><link rel="prefetch" href="/blog/assets/js/122.09187353.js"><link rel="prefetch" href="/blog/assets/js/123.7d6498a1.js"><link rel="prefetch" href="/blog/assets/js/124.bfa3d2c7.js"><link rel="prefetch" href="/blog/assets/js/125.af694e98.js"><link rel="prefetch" href="/blog/assets/js/126.1ef3d5c4.js"><link rel="prefetch" href="/blog/assets/js/127.aa57cac7.js"><link rel="prefetch" href="/blog/assets/js/128.1be22387.js"><link rel="prefetch" href="/blog/assets/js/129.26d8f73e.js"><link rel="prefetch" href="/blog/assets/js/13.384ea083.js"><link rel="prefetch" href="/blog/assets/js/130.68df5112.js"><link rel="prefetch" href="/blog/assets/js/131.ab94ddeb.js"><link rel="prefetch" href="/blog/assets/js/132.34eafedb.js"><link rel="prefetch" href="/blog/assets/js/133.180e2732.js"><link rel="prefetch" href="/blog/assets/js/134.e896b99a.js"><link rel="prefetch" href="/blog/assets/js/135.bee74f41.js"><link rel="prefetch" href="/blog/assets/js/136.d82aa22e.js"><link rel="prefetch" href="/blog/assets/js/137.339a5cb1.js"><link rel="prefetch" href="/blog/assets/js/138.5f7f7327.js"><link rel="prefetch" href="/blog/assets/js/139.7d667235.js"><link rel="prefetch" href="/blog/assets/js/14.6b8495d3.js"><link rel="prefetch" href="/blog/assets/js/140.ca69053a.js"><link rel="prefetch" href="/blog/assets/js/141.10f8759f.js"><link rel="prefetch" href="/blog/assets/js/142.f01f6545.js"><link rel="prefetch" href="/blog/assets/js/143.09617cd6.js"><link rel="prefetch" href="/blog/assets/js/144.80ac3552.js"><link rel="prefetch" href="/blog/assets/js/145.e8687bbb.js"><link rel="prefetch" href="/blog/assets/js/146.dede65cc.js"><link rel="prefetch" href="/blog/assets/js/147.deadcc6d.js"><link rel="prefetch" href="/blog/assets/js/148.97f6e203.js"><link rel="prefetch" href="/blog/assets/js/149.2201847b.js"><link rel="prefetch" href="/blog/assets/js/15.6818b7fd.js"><link rel="prefetch" href="/blog/assets/js/150.3d5ee53c.js"><link rel="prefetch" href="/blog/assets/js/151.cc45301a.js"><link rel="prefetch" href="/blog/assets/js/152.8393b4bc.js"><link rel="prefetch" href="/blog/assets/js/153.a106e956.js"><link rel="prefetch" href="/blog/assets/js/154.a12f38ce.js"><link rel="prefetch" href="/blog/assets/js/155.44eee9c3.js"><link rel="prefetch" href="/blog/assets/js/156.81d3a0eb.js"><link rel="prefetch" href="/blog/assets/js/157.d310f46e.js"><link rel="prefetch" href="/blog/assets/js/158.e7f3a78e.js"><link rel="prefetch" href="/blog/assets/js/159.55fc4a79.js"><link rel="prefetch" href="/blog/assets/js/16.341b7272.js"><link rel="prefetch" href="/blog/assets/js/160.8505bb9c.js"><link rel="prefetch" href="/blog/assets/js/161.4ce6ae0d.js"><link rel="prefetch" href="/blog/assets/js/162.7febda5f.js"><link rel="prefetch" href="/blog/assets/js/163.0144012c.js"><link rel="prefetch" href="/blog/assets/js/164.51b5fdeb.js"><link rel="prefetch" href="/blog/assets/js/165.9add3fc7.js"><link rel="prefetch" href="/blog/assets/js/166.3bea6bca.js"><link rel="prefetch" href="/blog/assets/js/167.77295bbf.js"><link rel="prefetch" href="/blog/assets/js/168.796c33be.js"><link rel="prefetch" href="/blog/assets/js/169.76a3f357.js"><link rel="prefetch" href="/blog/assets/js/17.16d9fbd4.js"><link rel="prefetch" href="/blog/assets/js/170.87faa96f.js"><link rel="prefetch" href="/blog/assets/js/171.5a01afac.js"><link rel="prefetch" href="/blog/assets/js/172.03904c56.js"><link rel="prefetch" href="/blog/assets/js/173.896758dd.js"><link rel="prefetch" href="/blog/assets/js/174.696e0a2c.js"><link rel="prefetch" href="/blog/assets/js/175.dfb72a35.js"><link rel="prefetch" href="/blog/assets/js/176.4c756b08.js"><link rel="prefetch" href="/blog/assets/js/177.92495f99.js"><link rel="prefetch" href="/blog/assets/js/178.6c90af23.js"><link rel="prefetch" href="/blog/assets/js/179.8aaf5715.js"><link rel="prefetch" href="/blog/assets/js/18.be4afb08.js"><link rel="prefetch" href="/blog/assets/js/180.c28b2e77.js"><link rel="prefetch" href="/blog/assets/js/181.a2150557.js"><link rel="prefetch" href="/blog/assets/js/182.608d7533.js"><link rel="prefetch" href="/blog/assets/js/183.dcd7caf3.js"><link rel="prefetch" href="/blog/assets/js/184.14f9c859.js"><link rel="prefetch" href="/blog/assets/js/185.2627ab6e.js"><link rel="prefetch" href="/blog/assets/js/19.a4adc151.js"><link rel="prefetch" href="/blog/assets/js/20.46ef1aca.js"><link rel="prefetch" href="/blog/assets/js/21.2be5744a.js"><link rel="prefetch" href="/blog/assets/js/22.7799aa96.js"><link rel="prefetch" href="/blog/assets/js/23.de99ed79.js"><link rel="prefetch" href="/blog/assets/js/24.b7fbd8f4.js"><link rel="prefetch" href="/blog/assets/js/25.e0286b4a.js"><link rel="prefetch" href="/blog/assets/js/26.25782bdf.js"><link rel="prefetch" href="/blog/assets/js/27.f4b90a64.js"><link rel="prefetch" href="/blog/assets/js/28.ef890190.js"><link rel="prefetch" href="/blog/assets/js/29.5f6a6a8f.js"><link rel="prefetch" href="/blog/assets/js/3.2f24c6d9.js"><link rel="prefetch" href="/blog/assets/js/30.fae9ceba.js"><link rel="prefetch" href="/blog/assets/js/31.a337e21a.js"><link rel="prefetch" href="/blog/assets/js/32.3c61104d.js"><link rel="prefetch" href="/blog/assets/js/33.b2f0a1b2.js"><link rel="prefetch" href="/blog/assets/js/34.f1170830.js"><link rel="prefetch" href="/blog/assets/js/35.a4de42af.js"><link rel="prefetch" href="/blog/assets/js/36.5fbe3d1c.js"><link rel="prefetch" href="/blog/assets/js/37.b0806903.js"><link rel="prefetch" href="/blog/assets/js/38.1a359170.js"><link rel="prefetch" href="/blog/assets/js/4.3977a209.js"><link rel="prefetch" href="/blog/assets/js/40.3ca4f646.js"><link rel="prefetch" href="/blog/assets/js/41.ebf9559b.js"><link rel="prefetch" href="/blog/assets/js/42.ee04f8a7.js"><link rel="prefetch" href="/blog/assets/js/43.88fcdf2d.js"><link rel="prefetch" href="/blog/assets/js/44.b5442fb9.js"><link rel="prefetch" href="/blog/assets/js/45.d5eb94fd.js"><link rel="prefetch" href="/blog/assets/js/46.8d875464.js"><link rel="prefetch" href="/blog/assets/js/47.52966fd1.js"><link rel="prefetch" href="/blog/assets/js/48.1f6739e5.js"><link rel="prefetch" href="/blog/assets/js/49.5aa04920.js"><link rel="prefetch" href="/blog/assets/js/5.93b2f136.js"><link rel="prefetch" href="/blog/assets/js/50.f2d3a23c.js"><link rel="prefetch" href="/blog/assets/js/51.580088b2.js"><link rel="prefetch" href="/blog/assets/js/52.4bb244fd.js"><link rel="prefetch" href="/blog/assets/js/53.9cc70af4.js"><link rel="prefetch" href="/blog/assets/js/54.fce0e522.js"><link rel="prefetch" href="/blog/assets/js/55.45218aad.js"><link rel="prefetch" href="/blog/assets/js/56.4a7b7f70.js"><link rel="prefetch" href="/blog/assets/js/57.a3032426.js"><link rel="prefetch" href="/blog/assets/js/58.c1a20724.js"><link rel="prefetch" href="/blog/assets/js/59.40a8e3f9.js"><link rel="prefetch" href="/blog/assets/js/6.8429dd54.js"><link rel="prefetch" href="/blog/assets/js/60.853ed1b4.js"><link rel="prefetch" href="/blog/assets/js/61.ee6c50dc.js"><link rel="prefetch" href="/blog/assets/js/62.5d2b3ad5.js"><link rel="prefetch" href="/blog/assets/js/63.8a27742e.js"><link rel="prefetch" href="/blog/assets/js/64.0b936975.js"><link rel="prefetch" href="/blog/assets/js/65.26802909.js"><link rel="prefetch" href="/blog/assets/js/66.36e30bea.js"><link rel="prefetch" href="/blog/assets/js/67.52fde5d5.js"><link rel="prefetch" href="/blog/assets/js/68.cf9db5a8.js"><link rel="prefetch" href="/blog/assets/js/69.2e2ba572.js"><link rel="prefetch" href="/blog/assets/js/7.337526f4.js"><link rel="prefetch" href="/blog/assets/js/70.df0ee471.js"><link rel="prefetch" href="/blog/assets/js/71.3f772ca6.js"><link rel="prefetch" href="/blog/assets/js/72.83f1b4cd.js"><link rel="prefetch" href="/blog/assets/js/73.ddf41ff8.js"><link rel="prefetch" href="/blog/assets/js/74.769fc5ad.js"><link rel="prefetch" href="/blog/assets/js/75.a68bc8c9.js"><link rel="prefetch" href="/blog/assets/js/76.61cd3314.js"><link rel="prefetch" href="/blog/assets/js/77.3c8f94c8.js"><link rel="prefetch" href="/blog/assets/js/78.c9e84a16.js"><link rel="prefetch" href="/blog/assets/js/79.0b64cc47.js"><link rel="prefetch" href="/blog/assets/js/80.43fb5a5e.js"><link rel="prefetch" href="/blog/assets/js/81.b4477c62.js"><link rel="prefetch" href="/blog/assets/js/82.5d46377b.js"><link rel="prefetch" href="/blog/assets/js/83.f793c7c7.js"><link rel="prefetch" href="/blog/assets/js/84.23cde58c.js"><link rel="prefetch" href="/blog/assets/js/85.e86969ef.js"><link rel="prefetch" href="/blog/assets/js/86.5df619a3.js"><link rel="prefetch" href="/blog/assets/js/87.ff656821.js"><link rel="prefetch" href="/blog/assets/js/88.8db93b7c.js"><link rel="prefetch" href="/blog/assets/js/89.671e61e0.js"><link rel="prefetch" href="/blog/assets/js/90.d42a0038.js"><link rel="prefetch" href="/blog/assets/js/91.a03ac2f8.js"><link rel="prefetch" href="/blog/assets/js/92.d5c60cff.js"><link rel="prefetch" href="/blog/assets/js/93.25ce91da.js"><link rel="prefetch" href="/blog/assets/js/94.e0ef0edd.js"><link rel="prefetch" href="/blog/assets/js/95.05e9349f.js"><link rel="prefetch" href="/blog/assets/js/96.22ebe11f.js"><link rel="prefetch" href="/blog/assets/js/97.9f61fcd1.js"><link rel="prefetch" href="/blog/assets/js/98.2cf0c871.js"><link rel="prefetch" href="/blog/assets/js/99.e2a05ce2.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.ef62c33d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.803dc0c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">技术小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/concurrent/" class="nav-link">
  高并发
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/io/" class="nav-link">
  IO
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/cache/" class="nav-link">
  缓存
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/collection/" class="nav-link">
  集合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/mybatis/" class="nav-link">
  MyBatis
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/netty/" class="nav-link">
  Netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/database/mysql/" class="nav-link router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/middleware/es/" class="nav-link">
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/blog/middleware/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/middleware/k8s/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><a href="/blog/design/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/util/" class="nav-link">
  工具向
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/concurrent/" class="nav-link">
  高并发
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/io/" class="nav-link">
  IO
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/cache/" class="nav-link">
  缓存
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/collection/" class="nav-link">
  集合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/mybatis/" class="nav-link">
  MyBatis
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/blog/frame/netty/" class="nav-link">
  Netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/database/mysql/" class="nav-link router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/middleware/es/" class="nav-link">
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/blog/middleware/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/middleware/k8s/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><a href="/blog/design/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/util/" class="nav-link">
  工具向
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/blog/personal/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/database/mysql/MySQL基础架构.html" class="sidebar-link">MySQL基础架构</a></li><li><a href="/blog/database/mysql/InnoDB存储引擎.html" class="sidebar-link">InnoDB存储引擎</a></li><li><a href="/blog/database/mysql/MySQL日志系统.html" class="sidebar-link">MySQL日志系统</a></li><li><a href="/blog/database/mysql/一条更新SQL的执行过程.html" class="sidebar-link">一条更新SQL的执行过程</a></li><li><a href="/blog/database/mysql/事务隔离.html" class="sidebar-link">事务隔离</a></li><li><a href="/blog/database/mysql/B树和B+树.html" class="sidebar-link">B树和B+树</a></li><li><a href="/blog/database/mysql/索引.html" class="sidebar-link">索引</a></li><li><a href="/blog/database/mysql/锁.html" class="active sidebar-link">锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#全局锁" class="sidebar-link">全局锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#应用场景-不推荐" class="sidebar-link">应用场景（不推荐）</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#可重复读进行备份" class="sidebar-link">可重复读进行备份</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#表级锁" class="sidebar-link">表级锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#表锁-不推荐" class="sidebar-link">表锁（不推荐）</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#元数据锁-mdl" class="sidebar-link">元数据锁（MDL）</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#表结构修改问题" class="sidebar-link">表结构修改问题</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#长事务阻塞问题" class="sidebar-link">长事务阻塞问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#行锁" class="sidebar-link">行锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#两阶段锁协议" class="sidebar-link">两阶段锁协议</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#事务中合理安排锁顺序" class="sidebar-link">事务中合理安排锁顺序</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#死锁" class="sidebar-link">死锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#死锁解决策略" class="sidebar-link">死锁解决策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#间隙锁" class="sidebar-link">间隙锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#可重复读的幻读问题" class="sidebar-link">可重复读的幻读问题</a></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#临键锁" class="sidebar-link">临键锁</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/database/mysql/锁.html#问题记录" class="sidebar-link">问题记录</a></li></ul></li><li><a href="/blog/database/mysql/行锁.html" class="sidebar-link">行锁</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MySQL总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/database/mysql/SQL语句的抖动问题.html" class="sidebar-link">SQL语句的抖动问题</a></li><li><a href="/blog/database/mysql/索引失效的场景.html" class="sidebar-link">索引失效的场景</a></li><li><a href="/blog/database/mysql/explain使用总结.html" class="sidebar-link">explain使用总结</a></li><li><a href="/blog/database/mysql/慢查询日志.html" class="sidebar-link">慢查询日志</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>问题总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/database/mysql/OrderBy和limit混用的bug.html" class="sidebar-link">OrderBy和limit混用的bug</a></li><li><a href="/blog/database/mysql/MySQL的binlog日志过期删除.html" class="sidebar-link">MySQL的binlog日志过期删除</a></li><li><a href="/blog/database/mysql/MySQL根据idb文件恢复数据.html" class="sidebar-link">MySQL根据idb文件恢复数据</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h1> <p>MySQL中加锁是为了处理并发问题，根据锁的粒度可以分为全局锁、表级锁和行锁。</p> <h2 id="全局锁"><a href="#全局锁" class="header-anchor">#</a> 全局锁</h2> <p>全局锁就是对整个数据库实例加锁。MySQL 提供了一个加全局读锁的方法，命令是 <code>Flush tables with read lock</code> (FTWRL)。</p> <p>加完之后整个数据库处于<strong>只读状态</strong>。</p> <hr> <h3 id="应用场景-不推荐"><a href="#应用场景-不推荐" class="header-anchor">#</a> 应用场景（不推荐）</h3> <p>全局锁的经典应用场景 <strong>数据库备份</strong>。</p> <p>由于加全局锁，会导致整个数据库只读，所以一般不推荐使用。</p> <h3 id="可重复读进行备份"><a href="#可重复读进行备份" class="header-anchor">#</a> 可重复读进行备份</h3> <p>备份数据库一般可以利用可重复读的事务隔离级别来实现，因为可重复读情况开始事务，会生成当前数据库的视图，保证整个事务期间以视图数据为准。</p> <p>官方自带的逻辑备份工具是 <code>mysqldump</code>。当 <code>mysqldump</code> 使用参数<code>–single-transaction</code>的时候，导数据之前就会启动一个事务，来确保拿到一致性视图。</p> <p>由于 MySQL 支持 <code>MVCC</code> （多版本控制协议），在开启事务的情况下，不影响其它线程对数据库进行更新等操作。</p> <hr> <blockquote><p>由于利用事务的隔离级别，要求 MySQL 使用的引擎要支持事务，像 MyISAM 便不支持事务，不能使用事务进行全局备份，只能利用全局锁 FTWRL 来实现。</p></blockquote> <h2 id="表级锁"><a href="#表级锁" class="header-anchor">#</a> 表级锁</h2> <p>MySQL 中表级锁有两种，一种是表锁，另一种是元数据锁（meta data lock，MDL）。</p> <h3 id="表锁-不推荐"><a href="#表锁-不推荐" class="header-anchor">#</a> 表锁（不推荐）</h3> <p>**表锁的语法是 <code>lock tables … read/write</code>。**与 FTWRL 类似，可以用 <code>unlock tables</code>主动释放锁，也可以在客户端断开的时候自动释放。需要注意，<code>lock tables</code> 语法除了会限制别的线程的读写外，也限定了本线程接下来的操作对象。</p> <p>表锁的粒度比较大，一般不推荐使用。</p> <p><strong>但是在没有元数据锁之前，如果要修改表结构，都需要加表锁。</strong></p> <h3 id="元数据锁-mdl"><a href="#元数据锁-mdl" class="header-anchor">#</a> 元数据锁（MDL）</h3> <p>MySQL 5.5 版本中引入了 MDL，不需要手动加，在访问表的时候自动加上。</p> <ul><li>对表数据进行增删改查的时候，加 <strong>读锁</strong>。</li> <li>对表结构进行修改的时候，加 <strong>写锁</strong>。</li></ul> <hr> <p>MySQL 支持多个线程同时对一张表进行增删改查，所以增删改查加读锁。</p> <p>但是读-写互斥、写-写互斥。表示修改表结构时，要等待读锁释放或者其它写锁释放。</p> <hr> <p>在事务情况下，执行SQL时申请MDL锁，但是执行完不会释放锁，而是直到事务结束才会释放锁。</p> <p>使用MDL时，一定注意不要长时间阻塞增删改查，影响业务。</p> <h3 id="表结构修改问题"><a href="#表结构修改问题" class="header-anchor">#</a> 表结构修改问题</h3> <p>MDL 能保证修改表结构的时候的原子性，不能多个线程同时修改表结构。</p> <p>而修改表结构，类似加索引、加字段、删除字段等操作，都需要<strong>扫描全表</strong>，操作每一条记录。假如表的数据量很大的情况下，会出现性能问题。</p> <p>大表的情况修改结构会长时间占用MDL写锁，影响对该表的查询。</p> <hr> <p>假如在查询频率高的情况，由于写锁的存在，查询的线程会一直阻塞等待，导致线程爆满。</p> <h3 id="长事务阻塞问题"><a href="#长事务阻塞问题" class="header-anchor">#</a> 长事务阻塞问题</h3> <p>大表由于数据量的原因，去改表结构，执行时间长是必然的。只能在特定时间去修改。</p> <p>而对于小表，急需修改表结构的情况。</p> <p><strong>要解决两个问题：</strong></p> <ol><li><p>其它线程的长事务问题。</p> <p>在 MySQL 的 <code>information_schema</code> 库的 <code>innodb_trx</code> 表中，你可以查到当前执行中的事务。</p> <p>如果你要做 DDL 变更的表刚好有长事务在执行，要考虑先暂停 DDL，或者 kill 掉这个长事务。</p></li> <li><p>自身等待时间长，阻塞其它线程。</p> <ol><li><p>为执行语句增加超时时间，超时放弃获取。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name NOWAIT <span class="token keyword">add</span> <span class="token keyword">column</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name WAIT N <span class="token keyword">add</span> <span class="token keyword">column</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重复执行语句，指到获取MDL进而执行。</p></li></ol></li></ol> <h2 id="行锁"><a href="#行锁" class="header-anchor">#</a> 行锁</h2> <p>MySQL 的行锁，是引擎自己实现的。MyIASM 就不支持行锁，若想要控制并发，只能使用表锁。InnoDB是支持行锁的，这也是 MyIASM 被 InnoDB 取代的原因之一。</p> <p><strong>行锁</strong>：<em>针对某一行记录加锁，保证记录的原子性</em>。</p> <h3 id="两阶段锁协议"><a href="#两阶段锁协议" class="header-anchor">#</a> 两阶段锁协议</h3> <p>在 InnoDB 事务中，行锁在需要的时候加上，但是要等事务 commit 之后才会释放。</p> <p><img src="https://s2.loli.net/2025/06/16/xMVYtAFmK45d8Nf.png" alt=""></p> <p>事务B 在 事务A commit 之前都处于阻塞状态。事务 A 的两条 SQL执行完，事务B依旧阻塞。</p> <h3 id="事务中合理安排锁顺序"><a href="#事务中合理安排锁顺序" class="header-anchor">#</a> 事务中合理安排锁顺序</h3> <p>由于事务中的行锁只有在 commit 时才会释放。</p> <p>所以尽量将会引起锁竞争的行锁，放在后面，减少锁的持有时间。</p> <p><img src="https://s2.loli.net/2025/06/16/2rRnNBEjHyglLWX.png" alt=""></p> <p>影院增加余额比较容易影响其它顾客的交易，产生锁竞争。所以可以按照3、1、2顺序调整，减少其锁的持有时间。</p> <h2 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h2> <p>在并发情况下，线程之间存在互相等待资源的情况，称为死锁。</p> <p><img src="https://s2.loli.net/2025/06/16/6fjF8quZJxdMc5G.png" alt=""></p> <p>比如行锁的情况下，事务A和事务B相互等待对方持有的锁，导致一直循环等待。出现死锁。</p> <h3 id="死锁解决策略"><a href="#死锁解决策略" class="header-anchor">#</a> 死锁解决策略</h3> <ol><li><p>过期策略。</p> <p>设置超时时间，超时放弃持有资源。可以设置<code>innodb_lock_wait_timeout</code>参数。</p> <blockquote><p>innodb_lock_wait_timeout 默认时间是50s，意味着发生死锁时，最少要50s才能破坏死锁。</p></blockquote></li> <li><p>主动破坏死锁 - <strong>死锁检测</strong>。</p> <p>主动发起死锁检测，发现死锁后，主动回滚其中的一个事务，保证其它事务继续执行，规避死锁。</p> <p>将参数 <code>innodb_deadlock_detect</code> 设置为 on，表示开启这个死锁检测。</p> <blockquote><p>死锁检测是很耗费CPU资源的，因为事务开启后，便要不停的检测需要的锁资源有没有被其它事务持有。最后判断是否出现死锁。</p></blockquote></li></ol> <h2 id="间隙锁"><a href="#间隙锁" class="header-anchor">#</a> 间隙锁</h2> <p>间隙锁只有在可重复读的隔离级别下才有，是为了解决可重复读的问题。</p> <h3 id="可重复读的幻读问题"><a href="#可重复读的幻读问题" class="header-anchor">#</a> 可重复读的幻读问题</h3> <ol><li><strong>查询涉及范围查询</strong>：使用 BETWEEN、IN、LIMIT 和 OFFSET 等条件。</li> <li><strong>在同一个事务中</strong>，两次执行相同的范围查询。</li> <li><strong>在两次查询之间</strong>，有其他事务插入了新的行，这些新行满足原来的查询条件。</li> <li>当前读，强制读取最新数据也会导致幻读。</li></ol> <p>间隙锁<strong>只要锁住的是范围内的数据，保证该范围数据不能被其它事务修改</strong>。</p> <p>当执行一个范围查询并请求锁时，InnoDB会锁定<strong>这个范围内的所有现有记录</strong>，同时还会<strong>锁定那些不存在于当前查询结果中但可能在范围内的记录</strong>。这样做可以防止其他事务在这个范围内插入新的记录，从而避免幻读的发生。</p> <h3 id="临键锁"><a href="#临键锁" class="header-anchor">#</a> 临键锁</h3> <p>间隙锁是对范围内数据进行加锁，防止间隙有数据新增或删除。</p> <p>而还需要对行记录加行锁，保证行记录不被其它事务篡改。</p> <p>间隙锁+行锁 = 临键锁 （Next-Key Locks），通过临键锁可以有效解决幻读的问题。</p> <h2 id="问题记录"><a href="#问题记录" class="header-anchor">#</a> 问题记录</h2> <p><img src="https://s2.loli.net/2025/06/16/sa5N3BX1dM24KyU.png" alt=""></p> <ol><li>直接删除 10000条，是一个长事务。</li> <li>每次删除500条，分20次删除。最为推荐，减少锁竞争和事务大小。</li> <li>20个线程同时删除500条数据，容易产生行锁竞争。</li></ol> <p><img src="https://s2.loli.net/2025/06/16/hjB7by3XG19HdLm.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/database/mysql/索引.html" class="prev">
        索引
      </a></span> <span class="next"><a href="/blog/database/mysql/行锁.html">
        行锁
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.36c7cd49.js" defer></script><script src="/blog/assets/js/2.5c52e41f.js" defer></script><script src="/blog/assets/js/1.65a7fcd1.js" defer></script><script src="/blog/assets/js/39.debd2e6a.js" defer></script>
  </body>
</html>
